package com.gtocore.common.data.machines;

import com.gtocore.api.machine.part.GTOPartAbility;
import com.gtocore.api.pattern.GTOPredicates;
import com.gtocore.client.renderer.machine.ArrayMachineRenderer;
import com.gtocore.client.renderer.machine.CustomPartRenderer;
import com.gtocore.common.data.GTOBlocks;
import com.gtocore.common.data.GTOMachines;
import com.gtocore.common.data.GTOMaterials;
import com.gtocore.common.data.GTORecipeTypes;
import com.gtocore.common.data.translation.GTOMachineStories;
import com.gtocore.common.data.translation.GTOMachineTooltips;
import com.gtocore.common.data.translation.GTOMachineTooltipsA;
import com.gtocore.common.machine.multiblock.electric.DrawingTowerMachine;
import com.gtocore.common.machine.multiblock.electric.SuperMolecularAssemblerMachine;
import com.gtocore.common.machine.multiblock.electric.TreeGrowthSimulator;
import com.gtocore.common.machine.multiblock.electric.adventure.BossSummonerMachine;
import com.gtocore.common.machine.multiblock.electric.processing.ProcessingArrayMachine;
import com.gtocore.common.machine.multiblock.electric.space.SatelliteControlCenterMachine;
import com.gtocore.common.machine.multiblock.electric.voidseries.VoidTransporterMachine;
import com.gtocore.common.machine.multiblock.noenergy.AlgaeFarmMachine;
import com.gtocore.common.machine.multiblock.noenergy.LargeCokeOvenMachine;
import com.gtocore.common.machine.multiblock.storage.MEStorageMachine;
import com.gtocore.common.machine.multiblock.storage.MultiblockCrateMachine;
import com.gtocore.common.machine.multiblock.storage.WirelessDimensionRepeaterMachine;
import com.gtocore.common.machine.multiblock.storage.WirelessEnergySubstationMachine;

import com.gtolib.GTOCore;
import com.gtolib.api.GTOValues;
import com.gtolib.api.annotation.NewDataAttributes;
import com.gtolib.api.data.GTODimensions;
import com.gtolib.api.lang.CNEN;
import com.gtolib.api.machine.impl.DrillingControlCenterMachine;
import com.gtolib.api.machine.impl.DroneControlCenterMachine;
import com.gtolib.api.machine.impl.MECPUMachine;
import com.gtolib.api.machine.impl.WirelessChargerMachine;
import com.gtolib.api.machine.multiblock.CoilMultiblockMachine;
import com.gtolib.api.machine.multiblock.ElectricMultiblockMachine;
import com.gtolib.api.machine.multiblock.TierCasingCrossRecipeMultiblockMachine;
import com.gtolib.api.machine.multiblock.TierCasingMultiblockMachine;
import com.gtolib.api.recipe.modifier.RecipeModifierFunction;
import com.gtolib.utils.MultiBlockFileReader;
import com.gtolib.utils.RLUtils;
import com.gtolib.utils.RegistriesUtils;

import com.gregtechceu.gtceu.GTCEu;
import com.gregtechceu.gtceu.api.data.chemical.ChemicalHelper;
import com.gregtechceu.gtceu.api.data.tag.TagPrefix;
import com.gregtechceu.gtceu.api.machine.MultiblockMachineDefinition;
import com.gregtechceu.gtceu.api.machine.multiblock.PartAbility;
import com.gregtechceu.gtceu.api.pattern.FactoryBlockPattern;
import com.gregtechceu.gtceu.api.pattern.util.RelativeDirection;
import com.gregtechceu.gtceu.common.data.*;

import net.minecraft.core.BlockPos;
import net.minecraft.world.level.block.Blocks;
import net.minecraft.world.level.material.Fluids;
import net.minecraft.world.phys.shapes.Shapes;

import earth.terrarium.adastra.common.registry.ModBlocks;

import static com.gregtechceu.gtceu.api.GTValues.*;
import static com.gregtechceu.gtceu.api.machine.multiblock.PartAbility.*;
import static com.gregtechceu.gtceu.api.pattern.Predicates.*;
import static com.gregtechceu.gtceu.common.data.GTBlocks.CASING_COKE_BRICKS;
import static com.gregtechceu.gtceu.common.data.GTMachines.COKE_OVEN_HATCH;
import static com.gregtechceu.gtceu.common.data.GTRecipeTypes.DUMMY_RECIPES;
import static com.gtocore.api.machine.part.GTOPartAbility.ACCELERATE_HATCH;
import static com.gtocore.common.data.GTORecipeTypes.CHEMICAL_VAPOR_DEPOSITION_RECIPES;
import static com.gtocore.common.data.GTORecipeTypes.PHYSICAL_VAPOR_DEPOSITION_RECIPES;
import static com.gtocore.utils.register.MachineRegisterUtils.multiblock;
import static com.gtocore.utils.register.MachineRegisterUtils.registerTieredMultis;
import static com.gtolib.api.GTOValues.GLASS_TIER;

public final class MultiBlockG {

    public static final MultiblockMachineDefinition LARGE_COKE_OVEN = multiblock("large_coke_oven", "大型焦炉", LargeCokeOvenMachine::new)
            .nonYAxisRotation()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(8))
            .recipeModifiers(RecipeModifierFunction.accurateParallel(8))
            .recipeTypes(GTRecipeTypes.COKE_OVEN_RECIPES)
            .block(GTBlocks.CASING_COKE_BRICKS)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(CASING_COKE_BRICKS.get()).or(blocks(COKE_OVEN_HATCH.get()).setMaxGlobalLimited(5)))
                    .where('B', controller(definition))
                    .where(' ', air())
                    .where('C', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_coke_bricks"), GTCEu.id("block/multiblock/coke_oven"))
            .register();

    public static final MultiblockMachineDefinition CRYSTALLIZATION_CHAMBER = multiblock("crystallization_chamber", "结晶器", CoilMultiblockMachine.createCoilMachine(false, true))
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getCrystallizationChamberTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.CRYSTALLIZATION_RECIPES)
            .overclock()
            .moduleTooltips(ACCELERATE_HATCH)
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("aaaaa", "aBBBa", "aBBBa", "aaaaa", "     ")
                    .aisle("aCCCa", "B   B", "B   B", "aCCCa", " aaa ")
                    .aisle("aCDCa", "B E B", "B E B", "aCDCa", " aaa ")
                    .aisle("aCCCa", "B   B", "B   B", "aCCCa", " aaa ")
                    .aisle("aa~aa", "aBBBa", "aBBBa", "aaaaa", "     ")
                    .where('~', controller(definition))
                    .where('a', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('C', heatingCoils())
                    .where('D', blocks(GTBlocks.CASING_INVAR_HEATPROOF.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Steel)))
                    .where(' ', any())
                    .build())
            .addSubPattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("ADDDA", "BBBBB", "BBBBB", "BBBBB", "BBBBB", "     ")
                    .aisle("ACCCA", "B B B", "B B B", "BEBEB", "BEBEB", " E E ")
                    .aisle("ACCCA", "BBBBB", "BBBBB", "BBBBB", "BBBBB", " E E ")
                    .aisle("     ", "     ", "     ", "     ", " E E ", " E E ")
                    .aisle("     ", "     ", "     ", "     ", "     ", "     ")
                    .aisle("     ", "     ", "     ", "     ", "     ", "     ")
                    .aisle("     ", "     ", "     ", "     ", "     ", "     ")
                    .aisle("  F  ", "     ", "     ", "     ", "     ", "     ")
                    .where('A', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(GTOPredicates.autoIOAbilities(definition.getRecipeTypes()))
                            .or(abilities(PartAbility.INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(ACCELERATE_HATCH).setMaxGlobalLimited(1)))
                    .where('B', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                    .where('C', blocks(GTBlocks.CASING_STEEL_SOLID.get()))
                    .where('D', blocks(GTBlocks.FIREBOX_STEEL.get()))
                    .where('E', blocks(GTBlocks.CASING_STEEL_PIPE.get()))
                    .where('F', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/large_chemical_reactor"))
            .register();

    public static final MultiblockMachineDefinition LARGE_CRYSTALLIZATION_CHAMBER = multiblock("large_crystallization_chamber", "大型结晶器", CoilMultiblockMachine.createCoilMachine(false, true))
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.CRYSTALLIZATION_RECIPES)
            .parallelizableTooltips()
            .parallelizableOverclock()
            .block(GCYMBlocks.CASING_HIGH_TEMPERATURE_SMELTING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GCYMBlocks.CASING_HIGH_TEMPERATURE_SMELTING.get())
                            .or(GTOPredicates.autoGCYMAbilities(definition.getRecipeTypes()))
                            .or(abilities(PARALLEL_HATCH).setExactLimit(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(GCYMBlocks.CASING_HIGH_TEMPERATURE_SMELTING.get()))
                    .where('C', blocks(GTOBlocks.HIGH_PRESSURE_RESISTANT_CASING.get()))
                    .where('D', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                    .where('E', blocks(GTBlocks.CASING_EXTREME_ENGINE_INTAKE.get()))
                    .where('F', blocks(GTOBlocks.MAGNESIUM_OXIDE_CERAMIC_HIGH_TEMPERATURE_INSULATION_MECHANICAL_BLOCK.get()))
                    .where('G', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.NaquadahAlloy)))
                    .where('H', blocks(GTBlocks.CASING_GRATE.get()))
                    .where('I', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                    .where('J', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Naquadah)))
                    .where('K', blocks(GTBlocks.FUSION_GLASS.get()))
                    .where('L', heatingCoils())
                    .where('M', blocks(GTOBlocks.PPS_CORROSION_RESISTANT_MECHANICAL_HOUSING.get()))
                    .where('N', blocks(GTOBlocks.BORON_CARBIDE_CERAMIC_RADIATION_RESISTANT_MECHANICAL_CUBE.get()))
                    .where('O', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                    .where('P', blocks(GCYMBlocks.CASING_CORROSION_PROOF.get()))
                    .where('Q', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.IncoloyMA956)))
                    .where('R', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/gcym/high_temperature_smelting_casing"), GTCEu.id("block/multiblock/large_chemical_reactor"))
            .register();

    public static final MultiblockMachineDefinition ALGAE_FARM = multiblock("algae_farm", "藻类农场", AlgaeFarmMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getAlgaeFarmTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getAlgaeFarmTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.DUMMY_RECIPES)
            .block(GTBlocks.PLASTCRETE)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTBlocks.PLASTCRETE.get()))
                    .where('B', blocks(GTBlocks.CASING_STEEL_PIPE.get()))
                    .where('C', blocks(GTOBlocks.BRASS_REINFORCED_WOODEN_CASING.get()))
                    .where('D', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Aluminium)))
                    .where('E', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('F', blocks(Blocks.GLASS))
                    .where('G', blocks(GTBlocks.PLASTCRETE.get())
                            .or(blocks(GTMachines.ITEM_IMPORT_BUS[ULV].get()).setMaxGlobalLimited(1))
                            .or(abilities(IMPORT_FLUIDS).setExactLimit(1))
                            .or(abilities(EXPORT_ITEMS).setExactLimit(1)))
                    .where('H', controller(definition))
                    .where('W', fluids(Fluids.WATER))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/cleanroom/plascrete"), GTCEu.id("block/multiblock/large_chemical_reactor"))
            .register();

    public static final MultiblockMachineDefinition POLYMERIZATION_REACTOR = multiblock("polymerization_reactor", "聚合反应器", CoilMultiblockMachine.createCoilMachine(false, false))
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.POLYMERIZATION_REACTOR_RECIPES)
            .recipeModifier(RecipeModifierFunction.coilReductionOverclock(0.5))
            .tooltips(GTOMachineStories.INSTANCE.getPolymerizationReactorTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getPolymerizationReactorTooltips().getSupplier())
            .parallelizableTooltips()
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('B', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('C', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(blocks(GTOMachines.MACHINE_ACCESS_LINK.get()).setMaxGlobalLimited(1, 0))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('D', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('E', heatingCoils())
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/large_chemical_reactor"))
            .register();

    public static final MultiblockMachineDefinition SATELLITE_CONTROL_CENTER = multiblock("satellite_control_center", "卫星控制中心", SatelliteControlCenterMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineTooltips.INSTANCE.getSatelliteControlCenterTooltips().getSupplier())
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.BACK, RelativeDirection.UP, RelativeDirection.LEFT)
                    .where('A', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('B', blocks(GTOBlocks.MULTI_FUNCTIONAL_CASING.get()))
                    .where('C', blocks(GTBlocks.CASING_STEEL_PIPE.get()))
                    .where('D', blocks(GTBlocks.CASING_STEEL_GEARBOX.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Steel)))
                    .where('F', blocks(GTBlocks.CASING_STEEL_SOLID.get()))
                    .where('G', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('H', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(1))
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(2))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('I', blocks(GTBlocks.CASING_STAINLESS_STEEL_GEARBOX.get()))
                    .where('J', blocks(GTBlocks.HERMETIC_CASING_HV.get()))
                    .where('K', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition ELECTRIC_COOKING = multiblock("electric_cooking", "电力烹饪锅", ElectricMultiblockMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.ELECTRIC_COOKING_RECIPES)
            .perfectOverclock()
            .perfectOCTooltips()
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('B', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('C', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('D', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('E', blocks(GTBlocks.COIL_CUPRONICKEL.get()))
                    .where('F', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/large_miner"))
            .register();

    public static final MultiblockMachineDefinition TREE_GROWTH_SIMULATOR = multiblock("tree_growth_simulator", "原木拟生场", TreeGrowthSimulator::new)
            .allRotation()
            .tooltips(GTOMachineTooltips.INSTANCE.getTreeGrowthSimulatorTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.TREE_GROWTH_SIMULATOR_RECIPES)
            .block(GTOBlocks.BRASS_REINFORCED_WOODEN_CASING)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle(" B   B ", " BBBBB ", "  GGG  ", "  GGG  ", "  GGG  ", " BBBBB ", "       ")
                    .aisle("AAEEEAA", "AAFFFAA", " A   A ", " A   A ", " A   A ", "BAEEEAB", " A   A ")
                    .aisle("BAAAAAB", "BCFFFCB", "BC   CB", "BC   CB", "BC   CB", "BDDDDDB", " AAAAA ")
                    .aisle("AAEEEAA", "AAFFFAA", " A   A ", " A   A ", " A   A ", "BAEEEAB", " A   A ")
                    .aisle(" B   B ", " BBHBB ", "  GGG  ", "  GGG  ", "  GGG  ", " BBBBB ", "       ")
                    .where('A', blocks(GCYMBlocks.CASING_INDUSTRIAL_STEAM.get()))
                    .where('B', blocks(GTOBlocks.BRASS_REINFORCED_WOODEN_CASING.get())
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(1))
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(2))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Steel)))
                    .where('D', blocks(GTBlocks.CASING_STEEL_GEARBOX.get()))
                    .where('E', blocks(GTOBlocks.REINFORCED_WOOD_CASING.get()))
                    .where('F', blocks(Blocks.MOSS_BLOCK))
                    .where('G', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('H', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/brass_reinforced_wooden_casing"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition LARGE_GREENHOUSE = multiblock("large_greenhouse", "大型温室", ElectricMultiblockMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.GREENHOUSE_RECIPES)
            .recipeTypes(GTORecipeTypes.TREE_GROWTH_SIMULATOR_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getLargeGreenhouseTooltips().getSupplier())
            .parallelizableTooltips()
            .parallelizableOverclock()
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('b', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('c', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('d', blocks(RegistriesUtils.getBlock("farmersdelight:rich_soil")))
                    .where('e', blocks(GTBlocks.CASING_POLYTETRAFLUOROETHYLENE_PIPE.get()))
                    .where('f', blocks(GTBlocks.CASING_GRATE.get()))
                    .where('a', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .setMinGlobalLimited(180)
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where(' ', air())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition ANCIENT_REACTOR_CORE = multiblock("ancient_reactor_core", "远古反应核", VoidTransporterMachine.create(1, 0, VoidTransporterMachine.teleportToDimension(GTODimensions.ANCIENT_WORLD, new BlockPos(0, 63, 0))))
            .nonYAxisRotation()
            .recipeTypes(DUMMY_RECIPES)
            .tooltipsText("右键核心传送到远古世界", "Right-click the core to send it to Ancient World.")
            .block(ModBlocks.STEEL_BLOCK)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(Blocks.DIAMOND_BLOCK))
                    .where('B', blocks(ModBlocks.STEEL_BLOCK.get()))
                    .where('C', controller(definition))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/reinforced_obsidian"), GTOCore.id("block/multiblock/ancient_reactor_core"))
            .register();

    public static final MultiblockMachineDefinition NETHER_REACTOR_CORE = multiblock("nether_reactor_core", "下界反应核", VoidTransporterMachine.create(2, 1920, VoidTransporterMachine.teleportToDimension(GTODimensions.THE_NETHER, new BlockPos(0, 63, 0))))
            .nonYAxisRotation()
            .recipeTypes(DUMMY_RECIPES)
            .tooltipsKey("gtceu.universal.tooltip.voltage_in", VA[EV], VNF[EV])
            .tooltipsText("运行后右键核心传送到下界", "Right-click the core to send it to the Nether.")
            .block(() -> ChemicalHelper.getBlock(TagPrefix.block, GTOMaterials.Soularium))
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(Blocks.GOLD_BLOCK)
                            .or(abilities(INPUT_ENERGY).setExactLimit(1)))
                    .where('B', blocks(ChemicalHelper.getBlock(TagPrefix.block, GTOMaterials.Soularium)))
                    .where('C', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(RLUtils.mc("block/gold_block"), GTOCore.id("block/multiblock/nether_reactor_core"))
            .register();

    public static final MultiblockMachineDefinition VOID_TRANSPORTER = multiblock("void_transporter", "虚空传送器", VoidTransporterMachine.create(0, 480))
            .nonYAxisRotation()
            .recipeTypes(DUMMY_RECIPES)
            .tooltipsKey("gtceu.universal.tooltip.voltage_in", VA[HV], VNF[HV])
            .tooltipsText("运行后右键黑曜石传送到虚空，如果是哭泣黑曜石则为超平坦", "Right-click obsidian to send it to the void, and if it is crying obsidian, it will be flat.")
            .block(GTOBlocks.REINFORCED_OBSIDIAN)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTOBlocks.REINFORCED_OBSIDIAN.get())
                            .or(abilities(INPUT_ENERGY).setExactLimit(1)))
                    .where('B', blocks(ANCIENT_REACTOR_CORE.get()))
                    .where('C', blocks(Blocks.OBSIDIAN).or(blocks(Blocks.CRYING_OBSIDIAN)))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/reinforced_obsidian"), GTCEu.id("block/multiblock/implosion_compressor"))
            .register();

    public static final MultiblockMachineDefinition BOSS_SUMMONER = multiblock("boss_summoner", "BOSS召唤器", BossSummonerMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineTooltips.INSTANCE.getBossSummonerTooltips().getSupplier())
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.MACHINE_CASING_ULV)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTBlocks.MACHINE_CASING_ULV.get()))
                    .where('a', blocks(GTBlocks.MACHINE_CASING_ULV.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2, 1)))
                    .where('B', blocks(ANCIENT_REACTOR_CORE.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/voltage/ulv/side"), GTCEu.id("block/multiblock/implosion_compressor"))
            .register();

    public static final MultiblockMachineDefinition DRILLING_CONTROL_CENTER = multiblock("drilling_control_center", "钻井控制中枢", DrillingControlCenterMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineTooltips.INSTANCE.getDrillingControlCenterTooltips().getSupplier())
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get()))
                    .where('C', blocks(GTBlocks.CASING_TITANIUM_STABLE.get()))
                    .where('D', blocks(GTOBlocks.TUNGSTEN_BOROSILICATE_GLASS.get()))
                    .where('E', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('F', blocks(GTBlocks.MACHINE_CASING_IV.get()))
                    .where('G', blocks(GTBlocks.CASING_TUNGSTENSTEEL_GEARBOX.get()))
                    .where('H', blocks(GTBlocks.HERMETIC_CASING_IV.get()))
                    .where('I', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTOCore.id("block/multiblock/general0"))
            .register();

    public static final MultiblockMachineDefinition DRONE_CONTROL_CENTER = multiblock("drone_control_center", "无人机控制中心", DroneControlCenterMachine::new)
            .nonYAxisRotation()
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('B', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(1))
                            .or(abilities(GTOPartAbility.DRONE_HATCH).setExactLimit(1)))
                    .where('C', blocks(GTBlocks.CASING_STAINLESS_STEEL_GEARBOX.get()))
                    .where('D', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTOCore.id("block/multiblock/general0"))
            .register();

    public static final MultiblockMachineDefinition WIRELESS_ENERGY_SUBSTATION = multiblock("wireless_energy_substation", "无线能源塔", WirelessEnergySubstationMachine::new)
            .nonYAxisRotation()
            .recipeTypes(DUMMY_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getWirelessEnergySubstationTooltips().getSupplier())
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.RIGHT, RelativeDirection.FRONT, RelativeDirection.UP)
                    .aisle("AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAABAAA")
                    .aisle("ACCCCCA", "CDDDDDC", "CDDDDDC", "CDDDDDC", "CDDDDDC", "CDDDDDC", "ACCCCCA").setRepeatable(2, 30)
                    .aisle("AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA", "AAAAAAA")
                    .where('A', blocks(GTBlocks.CASING_STEEL_SOLID.get()))
                    .where('B', controller(definition))
                    .where('C', GTOPredicates.glass())
                    .where('D', air().or(GTOPredicates.wirelessEnergyUnit()))
                    .build())
            .checkPriority(100000)
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/power_substation"))
            .register();

    public static final MultiblockMachineDefinition WIRELESS_DIMENSION_REPEATER = multiblock("wireless_dimension_repeater", "无线电网维度中继器", WirelessDimensionRepeaterMachine::new)
            .nonYAxisRotation()
            .workableInSpace()
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.CASING_PALLADIUM_SUBSTATION)
            .tooltips(GTOMachineTooltips.INSTANCE.getWirelessDimensionRepeaterTooltips().getSupplier())
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.BACK, RelativeDirection.UP, RelativeDirection.LEFT)
                    .where('A', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                    .where('B', GTOPredicates.integralFramework())
                    .where('C', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('D', blocks(Blocks.SEA_LANTERN))
                    .where('E', blocks(Blocks.CRYING_OBSIDIAN))
                    .where('F', blocks(RegistriesUtils.getBlock("ae2:quantum_ring")))
                    .where('G', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('H', controller(definition))
                    .where(' ', any())
                    .build())
            .checkPriority(1000)
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_palladium_substation"), GTCEu.id("block/multiblock/power_substation"))
            .register();

    public static final MultiblockMachineDefinition[] PROCESSING_ARRAY = registerTieredMultis("processing_array", t -> GTOValues.VNFR[t] + "处理阵列",
            ProcessingArrayMachine::new, (tier, builder) -> builder
                    .langValue(VNF[tier] + " Processing Array")
                    .nonYAxisRotation()
                    .recipeTypes(DUMMY_RECIPES)
                    .tooltipsKey("gtocore.machine.processing_array.tooltip.0")
                    .tooltipsKey("gtocore.machine.processing_array.tooltip.1")
                    .specialParallelizableTooltips()
                    .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(ProcessingArrayMachine.getMachineLimit(tier)))
                    .laserTooltips()
                    .block(() -> ProcessingArrayMachine.getCasingState(tier))
                    .blockProp(p -> p.noOcclusion().isViewBlocking((state, level, pos) -> false))
                    .shape(Shapes.box(0.001, 0.001, 0.001, 0.999, 0.999, 0.999))
                    .pattern(definition -> MultiBlockFileReader.start(definition)
                            .where('S', controller(definition))
                            .where('X', blocks(ProcessingArrayMachine.getCasingState(tier))
                                    .setMinGlobalLimited(6)
                                    .or(abilities(IMPORT_ITEMS))
                                    .or(abilities(EXPORT_ITEMS))
                                    .or(abilities(IMPORT_FLUIDS))
                                    .or(abilities(EXPORT_FLUIDS))
                                    .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(1))
                                    .or(abilities(INPUT_LASER).setMaxGlobalLimited(1))
                                    .or(blocks(GTOMachines.MACHINE_ACCESS_INTERFACE.get()).setExactLimit(1))
                                    .or(abilities(MAINTENANCE).setExactLimit(1)))
                            .where('C', GTOPredicates.glass())
                            .where('#', air())
                            .build())
                    .renderer(() -> new ArrayMachineRenderer(tier == IV ? GTCEu.id("block/casings/solid/machine_casing_robust_tungstensteel") : GTCEu.id("block/casings/solid/machine_casing_sturdy_hsse"), GTCEu.id("block/multiblock/gcym/large_assembler")))
                    .register(),
            IV, LuV);
    public static final MultiblockMachineDefinition SINTERING_FURNACE = multiblock("sintering_furnace", "烧结炉", CoilMultiblockMachine.createCoilMachine(false, true))
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getSinteringFurnaceTooltips().getSupplier())
            .parallelizableTooltips()
            .recipeTypes(GTORecipeTypes.SINTERING_FURNACE_RECIPES)
            .parallelizableOverclock()
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', controller(definition))
                    .where('C', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get()))
                    .where('D', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('F', heatingCoils())
                    .where('G', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('H', abilities(MUFFLER))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/blast_furnace"))
            .register();

    public static final MultiblockMachineDefinition ISOSTATIC_PRESS = multiblock("isostatic_press", "等静压成型", ElectricMultiblockMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getIsostaticPressMachineTooltips().getSupplier())
            .parallelizableTooltips()
            .recipeTypes(GTORecipeTypes.ISOSTATIC_PRESSING_RECIPES)
            .parallelizableOverclock()
            .block(GTBlocks.CASING_TITANIUM_STABLE)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTBlocks.CASING_TITANIUM_STABLE.get())
                            .or(GTOPredicates.autoAccelerateAbilities(definition.getRecipeTypes()))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(GTBlocks.CASING_TITANIUM_STABLE.get()))
                    .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.BlueSteel)))
                    .where('D', blocks(GTOBlocks.COMPRESSOR_CONTROLLER_CASING.get()))
                    .where('E', controller(definition))
                    .where('F', blocks(GTOBlocks.COMPRESSOR_PIPE_CASING.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_stable_titanium"), GTCEu.id("block/multiblock/gcym/large_material_press"))
            .register();

    public static final MultiblockMachineDefinition DRAWING_TOWER = multiblock("drawing_tower", "拉丝塔", DrawingTowerMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getDrawingTowerTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getDrawingTowerTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.DRAWING_RECIPES)
            .block(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.BACK, RelativeDirection.RIGHT, RelativeDirection.UP)
                    .aisle("NNNNNNNN", "NAAAAAAN", "NAAAAAAN", "NAAAAAAN", "NNNNNNNN")
                    .aisle("NNNNNNNN", "NAFA   N", "HCC    N", "NAFA   N", "NNNNNNNN")
                    .aisle(" AAAAAAA", " AFA   A", " CC B  A", " AFA   A", " AAAAAAA")
                    .aisle(" AAAAAAA", " AFFF  A", " CCBBB A", " AFFF  A", " AAAIAAA")
                    .aisle("  AAAAAA", "  AAA  A", "  C B  A", "  AAA  A", "  AAAAAA")
                    .aisle("   AABAA", "   A   A", "   B   A", "   A   A", "   AABAA")
                    .aisle("   CCBCC", "   C   C", "   B   B", "   C   C", "   CCBcC").setRepeatable(16, 96)
                    .aisle("   AAAAA", "   A   A", "   A   A", "   A   A", "   AAAAA")
                    .aisle("   DDADD", "   DGGGD", "   AG GA", "   DGGGD", "   DDADD")
                    .aisle("   DDADD", "   DGGGD", "   AG GA", "   DGGGD", "   DDADD")
                    .aisle("   AAAAA", "   A   A", "   A   A", "   A   A", "   AAAAA")
                    .aisle("   DDEDD", "   D   D", "   E   E", "   D   D", "   DDEDD")
                    .aisle("   DDEDD", "   D   D", "   E   E", "   D   D", "   DDEDD")
                    .aisle("   DDEDD", "   DDEDD", "   EEEEE", "   DDEDD", "   DDEDD")
                    .aisle("   AAAAA", "   AAAAA", "   AAMAA", "   AAAAA", "   AAAAA")
                    .where('A', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get()))
                    .where('M', abilities(IMPORT_ITEMS).setExactLimit(1))
                    .where('N', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get())
                            .or(abilities(EXPORT_ITEMS))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('C', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('c', GTOPredicates.countBlock("laminated_glass", GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('D', blocks(GTOBlocks.TUNGSTEN_BOROSILICATE_GLASS.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.TungstenSteel)))
                    .where('F', blocks(GTBlocks.CASING_TUNGSTENSTEEL_GEARBOX.get()))
                    .where('G', heatingCoils())
                    .where('H', controller(definition))
                    .where('I', blocks(GTOMachines.SPOOL_HATCH.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_robust_tungstensteel"), GTCEu.id("block/multiblock/large_miner"))
            .register();

    public static final MultiblockMachineDefinition ROCKET_ASSEMBLER = multiblock("rocket_assembler", "火箭装配机", ElectricMultiblockMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.ROCKET_ASSEMBLER_RECIPES)
            .overclock()
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(GTBlocks.CASING_STEEL_SOLID.get()))
                    .where('B', blocks(GTBlocks.CASING_STEEL_GEARBOX.get()))
                    .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Steel)))
                    .where('D', blocks(GTBlocks.CASING_GRATE.get()))
                    .where('E', blocks(GTBlocks.HERMETIC_CASING_LV.get()))
                    .where('F', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('G', blocks(GTBlocks.HERMETIC_CASING_HV.get()))
                    .where('H', blocks(GTBlocks.CASING_STAINLESS_STEEL_GEARBOX.get()))
                    .where('I', blocks(GTBlocks.CASING_STEEL_PIPE.get()))
                    .where('J', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('K', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/gcym/large_assembler"))
            .register();

    public static final MultiblockMachineDefinition GAS_COMPRESSOR = multiblock("gas_compressor", "气体压缩机", ElectricMultiblockMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.GAS_COMPRESSOR_RECIPES)
            .parallelizablePerfectOverclock()
            .parallelizableTooltips()
            .perfectOCTooltips()
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Invar)))
                    .where('B', blocks(GTBlocks.CASING_INVAR_HEATPROOF.get()))
                    .where('C', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('D', controller(definition))
                    .where('E', blocks(GTBlocks.CASING_STEEL_PIPE.get()))
                    .where('F', blocks(GTBlocks.HERMETIC_CASING_LV.get()))
                    .where('G', blocks(GTBlocks.STEEL_HULL.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/gcym/large_material_press"))
            .register();

    public static final MultiblockMachineDefinition SUPER_MOLECULAR_ASSEMBLER = multiblock("super_molecular_assembler", "超级分子装配室", SuperMolecularAssemblerMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.DUMMY_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getSuperMolecularAssemblerTooltips().getSupplier())
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(h -> h.addLines("合成物品的数量", "Amount of items to be crafted")))
            .multipleRecipesTooltips()
            .block(GTOBlocks.OXIDATION_RESISTANT_HASTELLOY_N_MECHANICAL_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.HastelloyN)))
                    .where('B', blocks(GTOBlocks.OXIDATION_RESISTANT_HASTELLOY_N_MECHANICAL_CASING.get()))
                    .where('C', blocks(GTOBlocks.ZIRCONIA_CERAMIC_HIGH_STRENGTH_BENDING_RESISTANCE_MECHANICAL_BLOCK.get()).setMinGlobalLimited(20)
                            .or(blocks(GTAEMachines.ME_CRAFT_PATTERN_PART_MACHINE.get()))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(EXPORT_ITEMS)))
                    .where('D', blocks(GTOBlocks.NAQUADAH_BOROSILICATE_GLASS.get()))
                    .where('E', blocks(GTOBlocks.MAGTECH_CASING.get()))
                    .where('F', blocks(GTOBlocks.PROCESS_MACHINE_CASING.get()))
                    .where('G', blocks(GTBlocks.CASING_ASSEMBLY_LINE.get()))
                    .where('H', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('I', blocks(GTOBlocks.COMPRESSOR_CONTROLLER_CASING.get()))
                    .where('J', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Europium)))
                    .where('K', blocks(GTOBlocks.EXTREME_DENSITY_CASING.get()))
                    .where('L', controller(definition))
                    .where(' ', any())
                    .build())
            .renderer(() -> new CustomPartRenderer(GTOCore.id("block/casings/oxidation_resistant_hastelloy_n_mechanical_casing"), GTCEu.id("block/multiblock/fusion_reactor"), GTOCore.id("block/zirconia_ceramic_high_strength_bending_resistance_mechanical_block")))
            .register();

    public static final MultiblockMachineDefinition RARITY_FORGE = multiblock("rarity_forge", "珍宝锻炉", ElectricMultiblockMachine::new)
            .allRotation()
            .tooltips(GTOMachineStories.INSTANCE.getRarityForgeTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.RARITY_FORGE_RECIPES)
            .block(GTBlocks.MACHINE_CASING_LV)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("A   A", "ABBBA", "A   A", "   A ", "   A ", "  A  ", " A   ", " A   ", "A   A", "ABBBA", "A   A")
                    .aisle(" AAA ", "BCCCB", " DDD ", "A E  ", "A E  ", " DDD ", "  E A", "  E A", " DDD ", "BCCCB", " AAA ")
                    .aisle(" AAA ", "BCCCB", " DCD ", " ECE ", " ECE ", "ADCDA", " ECE ", " ECE ", " DCD ", "BCCCB", " AAA ")
                    .aisle(" AAA ", "BCCCB", " DDD ", "  E A", "  E A", " DDD ", "A E  ", "A E  ", " DDD ", "BCCCB", " AAA ")
                    .aisle("A   A", "ABFBA", "A   A", " A   ", " A   ", "  A  ", "   A ", "   A ", "A   A", "ABBBA", "A   A")
                    .where('A', blocks(GTOBlocks.ORIGINAL_BRONZE_CASING.get()))
                    .where('B', blocks(GTBlocks.MACHINE_CASING_LV.get())
                            .or(GTOPredicates.autoThreadLaserAbilities(definition.getRecipeTypes()))
                            .or(abilities(INPUT_ENERGY)))
                    .where('C', blocks(RegistriesUtils.getBlock("ars_nouveau:smooth_sourcestone")))
                    .where('D', blocks(GTBlocks.MACHINE_CASING_ULV.get()))
                    .where('E', blocks(RegistriesUtils.getBlock("botania:mana_glass")))
                    .where('F', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/voltage/ulv/side"), GTOCore.id("block/multiblock/general0"))
            .register();

    public static final MultiblockMachineDefinition ME_STORAGE = multiblock("me_storage", "ME存储器", MEStorageMachine::new)
            .langValue("ME Storage")
            .allRotation()
            .tooltips(GTOMachineTooltips.INSTANCE.getMEStorageTooltips().getSupplier())
            .tooltips(NewDataAttributes.CAPACITY.create(CNEN.create("768 个ME存储核心", "768 ME Storage Cores")))
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.COMPUTER_CASING)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.BACK, RelativeDirection.UP, RelativeDirection.RIGHT)
                    .aisle("AAA", "DDD", "DDD", "DDD", "AAA")
                    .aisle("AAA", "DBD", "EBD", "DBD", "AAA")
                    .aisle("BBB", "BGB", "BGB", "BGB", "BBB")
                    .aisle("CBC", "cHc", "cHc", "cHc", "CBC").setRepeatable(1, 128)
                    .aisle("BBB", "BBB", "BBB", "BBB", "BBB")
                    .where('A', blocks(GTBlocks.COMPUTER_HEAT_VENT.get()))
                    .where('B', blocks(GTBlocks.COMPUTER_CASING.get()))
                    .where('C', GTOPredicates.absBlocks())
                    .where('D', blocks(GTBlocks.COMPUTER_CASING.get()).or(blocks(GTAEMachines.ME_STORAGE_ACCESS_HATCH.get(), GTAEMachines.ME_BIG_STORAGE_ACCESS_HATCH.get(), GTAEMachines.ME_IO_STORAGE_ACCESS_HATCH.get()).setExactLimit(1)))
                    .where('E', controller(definition))
                    .where('G', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('H', blocks(GTOBlocks.LITHIUM_OXIDE_CERAMIC_HEAT_RESISTANT_SHOCK_RESISTANT_MECHANICAL_CUBE.get()))
                    .where('c', GTOPredicates.MEStorageCore())
                    .build())
            .checkPriority(1000)
            .workableCasingRenderer(GTCEu.id("block/casings/hpca/computer_casing/back"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition ME_ENERGY_SUBSTATION = multiblock("me_energy_substation", "ME能源塔", TierCasingMultiblockMachine.createMachine(GLASS_TIER))
            .langValue("ME Energy Substation")
            .allRotation()
            .tooltips(GTOMachineTooltipsA.INSTANCE.getMeEnergySubstationTooltips().getSupplier())
            .recipeTypes(DUMMY_RECIPES)
            .block(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("AAAAA", "ABBBA", "ABCBA", "ABBBA", "AAAAA")
                    .aisle("ABBBA", "BDEDB", "BDFDB", "BDEDB", "ACCCA")
                    .aisle("ABCBA", "BEFEB", "CFHFC", "BEFEB", "ACCCA")
                    .aisle("ABBBA", "BDEDB", "BDFDB", "BDEDB", "ACCCA")
                    .aisle("AAGAA", "ABBBA", "ABCBA", "ABBBA", "AAAAA")
                    .where('A', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get())
                            .or(blocks(GTAEMachines.ME_ENERGY_ACCESS_HATCH.get()).setExactLimit(1))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2)))
                    .where('B', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('C', GTOPredicates.glass())
                    .where('D', blocks(GTBlocks.BATTERY_LAPOTRONIC_IV.get()))
                    .where('E', blocks(GTBlocks.BATTERY_EMPTY_TIER_II.get()))
                    .where('F', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.TungstenSteel)))
                    .where('G', controller(definition))
                    .where('H', blocks(RegistriesUtils.getBlock("ae2:energy_acceptor")))
                    .build())
            .addSubPattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle(" BBBBB ", " BFFFB ", " BFCFB ", " BFFFB ", " BBBBB ", " EE EE ", "  E E  ")
                    .aisle(" BCDCB ", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle(" BCDCB ", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle("ABCDCBA", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle("ABBDBBA", " BGEGB ", " DEJED ", " BGEGB ", " BBDBB ", " EE EE ", "  E E  ")
                    .aisle("ABBDBBA", "ABGEGBA", "ADEJEDA", "ABGEGBA", "ABBEBBA", " EEEEE ", "  E E  ")
                    .aisle("ABCDCBA", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle("ABCDCBA", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle("ABCDCBA", " CGEGC ", " DEIED ", " CGEGC ", " BCDCB ", "       ", "  E E  ")
                    .aisle("ABBBBBA", "ABFFFBA", "ABFCFBA", "ABFFFBA", "ABBEBBA", " EEEEE ", "  E E  ")
                    .aisle("A     A", "       ", "       ", "       ", "       ", " EE EE ", "  E E  ")
                    .aisle("A     A", "       ", "       ", "       ", "       ", "       ", "  E E  ")
                    .aisle("       ", "       ", "       ", "       ", "       ", "       ", "  E E  ")
                    .aisle("       ", "       ", "       ", "       ", "       ", "       ", "  E E  ")
                    .aisle("   H   ", "       ", "       ", "       ", "       ", " EE EE ", "  E E  ")
                    .where('A', blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get())
                            .or(abilities(INPUT_LASER).setMaxGlobalLimited(4)))
                    .where('B', blocks(GTBlocks.COMPUTER_CASING.get()))
                    .where('C', GTOPredicates.glass())
                    .where('D', blocks(GTBlocks.ADVANCED_COMPUTER_CASING.get()))
                    .where('E', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                    .where('F', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('G', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                    .where('H', controller(definition))
                    .where('I', blocks(GTBlocks.BATTERY_LAPOTRONIC_ZPM.get()))
                    .where('J', blocks(RegistriesUtils.getBlock("ae2:energy_acceptor")))
                    .where(' ', any())
                    .build())
            .checkPriority(1000)
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_robust_tungstensteel"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition WIRELESS_CHARGER = multiblock("wireless_charger", "无线充能器", WirelessChargerMachine::new)
            .allRotation()
            .addTooltipsFromClass(WirelessChargerMachine.class)
            .recipeTypes(GTORecipeTypes.DUMMY_RECIPES)
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('a', blocks(GTBlocks.CASING_STEEL_SOLID.get()).or(abilities(INPUT_ENERGY)))
                    .where('i', controller(definition))
                    .where('c', air())
                    .build())
            .checkPriority(1000)
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition INTEGRATED_VAPOR_DEPOSITION_SYSTEM = multiblock("integrated_vapor_deposition_system", "综合气相沉积系统",
            TierCasingCrossRecipeMultiblockMachine.createParallel(m -> 1L << (m.getCasingTier(GLASS_TIER) << 1), GLASS_TIER))
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getIntegratedVaporDepositionSystemTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(h -> h.addLines("4^玻璃等级", "4^(Glass Tier)")))
            .laserTooltips()
            .multipleRecipesTooltips()
            .recipeTypes(CHEMICAL_VAPOR_DEPOSITION_RECIPES, PHYSICAL_VAPOR_DEPOSITION_RECIPES)
            .block(GTOBlocks.IRIDIUM_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTOBlocks.ANTIFREEZE_HEATPROOF_MACHINE_CASING.get()))
                    .where('B', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.BabbittAlloy)))
                    .where('C', blocks(GTOBlocks.SPS_CASING.get()))
                    .where('D', GTOPredicates.glass())
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.NaquadahAlloy)))
                    .where('F', blocks(GTOBlocks.STABILIZED_NAQUADAH_WATER_PLANT_CASING.get()))
                    .where('G', blocks(GTBlocks.CASING_POLYTETRAFLUOROETHYLENE_PIPE.get()))
                    .where('H', blocks(GTOBlocks.LAFIUM_MECHANICAL_CASING.get()))
                    .where('I', blocks(GTOBlocks.HOLLOW_CASING.get()))
                    .where('J', blocks(GTOBlocks.HERMETIC_CASING_UEV.get()))
                    .where('K', blocks(GCYMBlocks.CASING_ATOMIC.get()))
                    .where('L', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                    .where('M', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.Laurenium)))
                    .where('N', blocks(GTOBlocks.AMPROSIUM_ACTIVE_CASING.get()))
                    .where('O', blocks(GTOBlocks.IRIDIUM_CASING.get())
                            .or(GTOPredicates.autoThreadLaserAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('P', controller(definition))
                    .where('Q', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                    .where('R', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                    .where('S', blocks(GTOBlocks.STRONTIUM_CARBONATE_CERAMIC_RAY_ABSORBING_MECHANICAL_CUBE.get()))
                    .where('T', blocks(GTOBlocks.NEUTRONIUM_STABLE_CASING.get()))
                    .where('U', blocks(GTOBlocks.AMPROSIUM_PIPE_CASING.get()))
                    .where('V', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Polytetrafluoroethylene)))
                    .where('W', blocks(GTOBlocks.ADVANCED_ASSEMBLY_LINE_UNIT.get()))
                    .where('X', blocks(GCYMBlocks.CASING_CORROSION_PROOF.get()))
                    .where('Y', blocks(GTOBlocks.CONTAINMENT_FIELD_GENERATOR.get()))
                    .where('Z', blocks(GTOBlocks.NAQUADAH_REINFORCED_PLANT_CASING.get()))
                    .where('[', blocks(GTOBlocks.QUANTUM_GLASS.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/iridium_casing"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition MULTIBLOCK_CRATE = multiblock("multiblock_crate", "多方块板条箱", MultiblockCrateMachine::new)
            .allRotation()
            .recipeTypes(GTORecipeTypes.DUMMY_RECIPES)
            .block(GTBlocks.STEEL_HULL)
            .tooltips(GTOMachineTooltips.INSTANCE.getMultiblockCrateMachineTooltips().getSupplier())
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('a', blocks(GTBlocks.STEEL_HULL.get()))
                    .where('i', controller(definition))
                    .where('c', air())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/steam/steel/side"), GTCEu.id("block/multiblock/multiblock_tank"))
            .register();

    public static final MultiblockMachineDefinition ME_CPU = multiblock("me_cpu", "ME超算核心", MECPUMachine::new)
            .langValue("ME Super Computer Core")
            .allRotation()
            .recipeTypes(GTORecipeTypes.DUMMY_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getMECPUTooltips().getSupplier())
            .block(GCYMBlocks.CASING_NONCONDUCTING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTOBlocks.HIGH_STRENGTH_CONCRETE.get()))
                    .where('B', blocks(GCYMBlocks.CASING_NONCONDUCTING.get())
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(blocks(GTAEMachines.CRAFTING_CPU_INTERFACE.get()).setExactLimit(1)))
                    .where('C', blocks(GCYMBlocks.MOLYBDENUM_DISILICIDE_COIL_BLOCK.get()))
                    .where('D', blocks(GCYMBlocks.CASING_NONCONDUCTING.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.BlackSteel)))
                    .where('F', blocks(GTOBlocks.COBALT_OXIDE_CERAMIC_STRONG_THERMALLY_CONDUCTIVE_MECHANICAL_BLOCK.get()))
                    .where('G', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                    .where('H', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                    .where('I', blocks(GCYMBlocks.CASING_LASER_SAFE_ENGRAVING.get()))
                    .where('J', blocks(GTOBlocks.OXIDATION_RESISTANT_HASTELLOY_N_MECHANICAL_CASING.get()))
                    .where('K', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.StainlessSteel)))
                    .where('L', blocks(GTBlocks.CASING_EXTREME_ENGINE_INTAKE.get()))
                    .where('M', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('N', GTOPredicates.glass())
                    .where('O', GTOPredicates.craftingStorageCore().or(blocks(RegistriesUtils.getBlock("ae2:crafting_unit")).setMaxGlobalLimited(480)))
                    .where('P', blocks(GTBlocks.FILTER_CASING.get()))
                    .where('Q', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/gcym/nonconducting_casing"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static void init() {}
}
