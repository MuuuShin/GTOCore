package com.gtocore.common.data.machines;

import com.gtocore.api.machine.part.GTOPartAbility;
import com.gtocore.api.pattern.GTOPredicates;
import com.gtocore.client.renderer.machine.*;
import com.gtocore.common.block.FusionCasings;
import com.gtocore.common.data.*;
import com.gtocore.common.data.translation.GTOMachineStories;
import com.gtocore.common.data.translation.GTOMachineTooltips;
import com.gtocore.common.data.translation.GTOMachineTooltipsA;
import com.gtocore.common.machine.multiblock.electric.*;
import com.gtocore.common.machine.multiblock.electric.adventure.SlaughterhouseMachine;
import com.gtocore.common.machine.multiblock.electric.assembly.AdvancedAssemblyLineMachine;
import com.gtocore.common.machine.multiblock.electric.assembly.CircuitAssemblyLineMachine;
import com.gtocore.common.machine.multiblock.electric.bioengineering.IncubatorMachine;
import com.gtocore.common.machine.multiblock.electric.nano.NanoForgeMachine;
import com.gtocore.common.machine.multiblock.electric.processing.ColdIceFreezerMachine;
import com.gtocore.common.machine.multiblock.electric.processing.ProcessingPlantMachine;
import com.gtocore.common.machine.multiblock.electric.smelter.BlazeBlastFurnaceMachine;
import com.gtocore.common.machine.multiblock.electric.smelter.DimensionallyTranscendentPlasmaForgeMachine;
import com.gtocore.common.machine.multiblock.electric.space.SpaceElevatorMachine;
import com.gtocore.common.machine.multiblock.electric.space.SpaceElevatorModuleMachine;
import com.gtocore.common.machine.multiblock.electric.space.SpaceProbeSurfaceReceptionMachine;
import com.gtocore.common.machine.multiblock.electric.voidseries.INFFluidDrillMachine;
import com.gtocore.common.machine.multiblock.noenergy.GodForgeMachine;
import com.gtocore.common.machine.multiblock.noenergy.HarmonyMachine;
import com.gtocore.common.machine.multiblock.noenergy.HeatExchangerMachine;
import com.gtocore.common.machine.multiblock.noenergy.NeutronActivatorMachine;

import com.gtolib.GTOCore;
import com.gtolib.api.annotation.NewDataAttributes;
import com.gtolib.api.lang.CNEN;
import com.gtolib.api.machine.MultiblockDefinition;
import com.gtolib.api.machine.multiblock.CoilCrossRecipeMultiblockMachine;
import com.gtolib.api.recipe.RecipeType;
import com.gtolib.api.recipe.modifier.RecipeModifierFunction;
import com.gtolib.utils.*;

import com.gregtechceu.gtceu.GTCEu;
import com.gregtechceu.gtceu.api.GTValues;
import com.gregtechceu.gtceu.api.capability.recipe.ItemRecipeCapability;
import com.gregtechceu.gtceu.api.data.chemical.ChemicalHelper;
import com.gregtechceu.gtceu.api.data.tag.TagPrefix;
import com.gregtechceu.gtceu.api.machine.MultiblockMachineDefinition;
import com.gregtechceu.gtceu.api.machine.multiblock.PartAbility;
import com.gregtechceu.gtceu.api.pattern.*;
import com.gregtechceu.gtceu.api.pattern.util.RelativeDirection;
import com.gregtechceu.gtceu.client.renderer.machine.FusionReactorRenderer;
import com.gregtechceu.gtceu.common.data.*;
import com.gregtechceu.gtceu.common.machine.multiblock.electric.FusionReactorMachine;
import com.gregtechceu.gtceu.utils.FormattingUtil;

import net.minecraft.core.Direction;
import net.minecraft.network.chat.Component;
import net.minecraft.server.level.ServerLevel;
import net.minecraft.world.item.ItemStack;
import net.minecraft.world.item.crafting.Ingredient;
import net.minecraft.world.level.block.Block;
import net.minecraft.world.level.block.Blocks;

import earth.terrarium.adastra.common.registry.ModItems;

import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import java.util.function.Function;

import static com.gregtechceu.gtceu.api.GTValues.LuV;
import static com.gregtechceu.gtceu.api.pattern.Predicates.*;
import static com.gtocore.api.machine.part.GTOPartAbility.*;
import static com.gtocore.common.block.BlockMap.SEPMMAP;
import static com.gtocore.common.data.GTORecipeTypes.*;
import static com.gtocore.utils.register.MachineRegisterUtils.multiblock;
import static com.gtocore.utils.register.MachineRegisterUtils.registerTieredMultis;
import static com.gtolib.api.GTOValues.POWER_MODULE_TIER;

public final class MultiBlockD {

    public static void init() {}

    public static final MultiblockMachineDefinition GREENHOUSE = multiblock("greenhouse", "温室", GreenhouseMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.GREENHOUSE_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getGreenhouseTooltips().getSupplier())
            .overclock()
            .block(GTBlocks.MACHINE_CASING_ULV)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('E', controller(definition))
                    .where('G', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('B', blocks(GTBlocks.MACHINE_CASING_ULV.get())
                            .setMinGlobalLimited(40)
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('d', blocks(RegistriesUtils.getBlock("farmersdelight:rich_soil")))
                    .where('#', air())
                    .where('0', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/voltage/ulv/side"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition EYE_OF_HARMONY = multiblock("eye_of_harmony", "鸿蒙之眼", HarmonyMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.COSMOS_SIMULATION_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getEyeOfHarmonyTooltips().getSupplier())
            .fromSourceTooltips("GTNH")
            .block(GTBlocks.HIGH_POWER_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTOBlocks.DIMENSIONALLY_TRANSCENDENT_CASING.get()))
                    .where('B', blocks(GTBlocks.HIGH_POWER_CASING.get())
                            .or(abilities(EXPORT_ITEMS).setPreviewCount(1))
                            .or(abilities(IMPORT_ITEMS).setPreviewCount(1))
                            .or(abilities(EXPORT_FLUIDS).setPreviewCount(1))
                            .or(abilities(IMPORT_FLUIDS).setPreviewCount(1)))
                    .where('D', blocks(GTOBlocks.DIMENSION_INJECTION_CASING.get()))
                    .where('E', blocks(GTOBlocks.DIMENSIONAL_BRIDGE_CASING.get()))
                    .where('F', blocks(GTOBlocks.SPACETIME_COMPRESSION_FIELD_GENERATOR.get()))
                    .where('G', blocks(GTOBlocks.DIMENSIONAL_STABILITY_CASING.get()))
                    .where(' ', any())
                    .build())
            .renderer(EyeOfHarmonyRenderer::new)
            .hasTESR(true)
            .register();

    public static final MultiblockMachineDefinition SPACE_PROBE_SURFACE_RECEPTION = multiblock("space_probe_surface_reception", "宇宙探测器地面接收单元", SpaceProbeSurfaceReceptionMachine::new)
            .nonYAxisRotation()
            .workableInSpace()
            .recipeTypes(GTORecipeTypes.SPACE_PROBE_SURFACE_RECEPTION_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getSpaceProbeSurfaceReceptionTooltips().getSupplier())
            .perfectOCTooltips()
            .block(GCYMBlocks.CASING_ATOMIC)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTOBlocks.COSMIC_DETECTION_RECEIVER_MATERIAL_RAY_ABSORBING_ARRAY.get()))
                    .where('B', blocks(GTOBlocks.NAQUADAH_REINFORCED_PLANT_CASING.get()))
                    .where('C', blocks(GTOBlocks.HIGH_PRESSURE_RESISTANT_CASING.get()))
                    .where('D', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Neutronium)))
                    .where('E', blocks(GCYMBlocks.CASING_ATOMIC.get()))
                    .where('F', blocks(GTOBlocks.HYPER_MECHANICAL_CASING.get()))
                    .where('G', blocks(GTOBlocks.NEUTRONIUM_STABLE_CASING.get()))
                    .where('H', blocks(GTOBlocks.HYPER_CORE.get()))
                    .where('I', blocks(GCYMBlocks.HEAT_VENT.get()))
                    .where('J', blocks(GTOBlocks.ANTIFREEZE_HEATPROOF_MACHINE_CASING.get()))
                    .where('K', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('L', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.BlackTitanium)))
                    .where('M', blocks(GTOBlocks.AMPROSIUM_ACTIVE_CASING.get()))
                    .where('b', blocks(GCYMBlocks.CASING_ATOMIC.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1))
                            .or(abilities(COMPUTATION_DATA_RECEPTION).setExactLimit(1)))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/gcym/atomic_casing"), GTCEu.id("block/multiblock/data_bank"))
            .register();

    public static final MultiblockMachineDefinition HYPERDIMENSIONAL_PLASMA_FUSION_CORE = multiblock("hyperdimensional_plasma_fusion_core", "高维等离子聚变核心", DimensionallyTranscendentPlasmaForgeMachine::new)
            .disabledCombined()
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.DIMENSIONALLY_TRANSCENDENT_PLASMA_FORGE_RECIPES)
            .recipeTypes(GTORecipeTypes.STELLAR_FORGE_RECIPES)
            .parallelizableTooltips()
            .laserTooltips()
            .parallelizableOverclock()
            .multipleRecipesTooltips()
            .block(GTOBlocks.DIMENSIONALLY_TRANSCENDENT_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTOBlocks.STRENGTHEN_THE_BASE_BLOCK.get()))
                    .where('B', blocks(GTOBlocks.DIMENSIONALLY_TRANSCENDENT_CASING.get())
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(GTOPredicates.autoThreadLaserAbilities(definition.getRecipeTypes())))
                    .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.Amprosium)))
                    .where('D', blocks(GTOBlocks.SPS_CASING.get()))
                    .where('E', GTOPredicates.absBlocks())
                    .where('F', blocks(GTOBlocks.STRONTIUM_CARBONATE_CERAMIC_RAY_ABSORBING_MECHANICAL_CUBE.get()))
                    .where('G', blocks(GTBlocks.FUSION_GLASS.get()))
                    .where('H', blocks(GTOBlocks.DIMENSIONALLY_TRANSCENDENT_CASING.get()))
                    .where('I', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('J', blocks(GTOBlocks.MOLECULAR_COIL.get()))
                    .where('K', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Naquadria)))
                    .where('L', blocks(GTOBlocks.HYPER_CORE.get()))
                    .where('M', blocks(GTOBlocks.DIMENSIONAL_BRIDGE_CASING.get()))
                    .where('N', blocks(GTOBlocks.ABS_ORANGE_CASING.get()))
                    .where('O', blocks(GTOBlocks.HIGH_STRENGTH_CONCRETE.get()))
                    .where('P', heatingCoils())
                    .where('Q', blocks(GTOBlocks.COBALT_OXIDE_CERAMIC_STRONG_THERMALLY_CONDUCTIVE_MECHANICAL_BLOCK.get()))
                    .where('R', blocks(GTOBlocks.RHENIUM_REINFORCED_ENERGY_GLASS.get()))
                    .where('S', blocks(GTOBlocks.HOLLOW_CASING.get()))
                    .where('T', blocks(GTOBlocks.DIMENSION_INJECTION_CASING.get()))
                    .where('U', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/dimensionally_transcendent_casing"), GTOCore.id("block/multiblock/dimensionally_transcendent_plasma_forge"))
            .register();

    public static final MultiblockMachineDefinition CIRCUIT_ASSEMBLY_LINE = multiblock("circuit_assembly_line", "电路装配线", CircuitAssemblyLineMachine::new)
            .allRotation()
            .recipeTypes(CIRCUIT_ASSEMBLY_LINE_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getCircuitAssemblyLineTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(h -> h.addLines("同配方机器人数量x2的并行", "Parallelism of x2 for the same recipe robots")))
            .block(GTOBlocks.PIKYONIUM_MACHINE_CASING)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("bbb", "bbb", "bfb")
                    .aisle("bbb", "cec", "bdb").setRepeatable(16)
                    .aisle("bbb", "bab", "bgb")
                    .where('a', controller(definition))
                    .where('b', blocks(GTOBlocks.PIKYONIUM_MACHINE_CASING.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('c', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('d', blocks(GTOMachines.HUGE_ITEM_IMPORT_BUS.get()).or(blocks(GTMachines.ITEM_IMPORT_BUS[0].get())))
                    .where('e', blocks(GTOBlocks.MACHINE_CASING_CIRCUIT_ASSEMBLY_LINE.get()))
                    .where('f', abilities(EXPORT_ITEMS))
                    .where('g', abilities(IMPORT_FLUIDS_4X))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/pikyonium_machine_casing"), GTCEu.id("block/multiblock/assembly_line"))
            .register();

    public static final MultiblockMachineDefinition ASSEMBLER_MODULE = multiblock("assembler_module", "太空电梯组装模块", (holder) -> new SpaceElevatorModuleMachine(holder, true))
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.ASSEMBLER_MODULE_RECIPES)
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(h -> h.addLines("4^(动力模块等级-1)", "4^(Power Module tier - 1)")))
            .block(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('b', blocks(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING.get())
                            .or(autoAbilities(definition.getRecipeTypes())))
                    .where('a', blocks(GTOBlocks.SPACE_ELEVATOR_MODULE_BASE.get()))
                    .where('c', blocks(GTOBlocks.MODULE_CONNECTOR.get()))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/space_elevator_mechanical_casing"), GTCEu.id("block/multiblock/gcym/large_assembler"))
            .register();

    public static final MultiblockMachineDefinition RESOURCE_COLLECTION_MODULE = multiblock("resource_collection_module", "太空电梯资源采集模块", (holder) -> new SpaceElevatorModuleMachine(holder, false))
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.MINER_MODULE_RECIPES)
            .recipeTypes(GTORecipeTypes.DRILLING_MODULE_RECIPES)
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(h -> h.addLines("4^(动力模块等级-1)", "4^(Power Module tier - 1)")))
            .block(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('b', blocks(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING.get())
                            .or(autoAbilities(definition.getRecipeTypes())))
                    .where('a', blocks(GTOBlocks.SPACE_ELEVATOR_MODULE_BASE.get()))
                    .where('c', blocks(GTOBlocks.MODULE_CONNECTOR.get()))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/space_elevator_mechanical_casing"), GTCEu.id("block/multiblock/gcym/large_assembler"))
            .register();

    public static final MultiblockMachineDefinition BLOCK_CONVERSION_ROOM = multiblock("block_conversion_room", "方块转换室", holder -> new BlockConversionRoomMachine(holder, false))
            .noneRotation()
            .recipeTypes(GTORecipeTypes.BLOCK_CONVERSIONRECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getBlockConversionRoomTooltips().getSupplier())
            .block(GTOBlocks.ALUMINIUM_BRONZE_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('a', controller(definition))
                    .where('b', blocks(GTOBlocks.ALUMINIUM_BRONZE_CASING.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(blocks(GTOMachines.BLOCK_BUS.get()).setMaxGlobalLimited(1)))
                    .where('c', blocks(GTOBlocks.SHINING_OBSIDIAN.get()))
                    .where('d', blocks(GTBlocks.CASING_TEMPERED_GLASS.get())
                            .or(blocks(Blocks.IRON_DOOR).setMaxGlobalLimited(4).setPreviewCount(1)))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/aluminium_bronze_casing"), GTCEu.id("block/multiblock/cleanroom"))
            .register();

    public static final MultiblockMachineDefinition LARGE_BLOCK_CONVERSION_ROOM = multiblock("large_block_conversion_room", "大型方块转换室", holder -> new BlockConversionRoomMachine(holder, true))
            .noneRotation()
            .recipeTypes(GTORecipeTypes.BLOCK_CONVERSIONRECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getLargeBlockConversionRoomTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getLargeBlockConversionRoomTooltips().getSupplier())
            .block(GTOBlocks.ALUMINIUM_BRONZE_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('a', controller(definition))
                    .where('b', blocks(GTOBlocks.ALUMINIUM_BRONZE_CASING.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2))
                            .or(blocks(GTOMachines.BLOCK_BUS.get()).setMaxGlobalLimited(1)))
                    .where('c', blocks(GTOBlocks.SHINING_OBSIDIAN.get()))
                    .where('d', blocks(GTBlocks.CASING_TEMPERED_GLASS.get())
                            .or(blocks(Blocks.IRON_DOOR).setMaxGlobalLimited(4).setPreviewCount(1)))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/aluminium_bronze_casing"), GTCEu.id("block/multiblock/cleanroom"))
            .register();

    public static final MultiblockMachineDefinition PCB_FACTORY = multiblock("pcb_factory", "PCB工厂", PCBFactoryMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.PCB_FACTORY_RECIPES)
            .parallelizableTooltips()
            .tooltips(GTOMachineStories.INSTANCE.getPCBFactoryTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getPCBFactoryTooltips().getSupplier())
            .laserTooltips()
            .block(GTOBlocks.IRIDIUM_CASING)
            .pattern(definition -> PCBFactoryMachine.getBlockPattern(1, definition))
            .shapeInfos(definition -> {
                List<MultiblockShapeInfo> shapeInfos = new ArrayList<>();
                for (int i = 1; i < 4; i++) {
                    shapeInfos.addAll(MultiblockDefinition.getMatchingShapes(false, PCBFactoryMachine.getBlockPattern(i, definition)));
                }
                return shapeInfos;
            })
            .workableCasingRenderer(GTOCore.id("block/casings/iridium_casing"), GTCEu.id("block/multiblock/gcym/large_maceration_tower"))
            .register();

    public static final MultiblockMachineDefinition BLAZE_BLAST_FURNACE = multiblock("blaze_blast_furnace", "烈焰高炉", BlazeBlastFurnaceMachine::new)
            .allRotation()
            .recipeTypes(GTRecipeTypes.BLAST_RECIPES)
            .durationMultiplierTooltips(0.5)
            .tooltips(GTOMachineStories.INSTANCE.getBlazeBlastFurnaceTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getBlazeBlastFurnaceTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(64))
            .block(GTOBlocks.BLAZE_CASING)
            .upgradable()
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('A', blocks(GCYMBlocks.CASING_HIGH_TEMPERATURE_SMELTING.get()))
                    .where('B', blocks(GCYMBlocks.HEAT_VENT.get()))
                    .where('C', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                    .where('D', blocks(GTOBlocks.BLAZE_CASING.get()))
                    .where('E', blocks(GTOBlocks.BLAZE_CASING.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('F', heatingCoils())
                    .where('G', controller(definition))
                    .where('H', abilities(MUFFLER))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/blaze_casing"), GTCEu.id("block/multiblock/blast_furnace"))
            .register();

    public static final MultiblockMachineDefinition COLD_ICE_FREEZER = multiblock("cold_ice_freezer", "寒冰冷冻机", ColdIceFreezerMachine::new)
            .allRotation()
            .moduleTooltips(new PartAbility[] { GTOPartAbility.ACCELERATE_HATCH }, new RecipeType[] { ATOMIZATION_CONDENSATION_RECIPES })
            .disabledCombined()
            .recipeTypes(GTRecipeTypes.VACUUM_RECIPES, ATOMIZATION_CONDENSATION_RECIPES)
            .durationMultiplierTooltips(0.5)
            .tooltips(GTOMachineStories.INSTANCE.getColdIceFreezerTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getColdIceFreezerTooltips().getSupplier())
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(64))
            .recipeModifiers(RecipeModifierFunction.overclocking(0.5, 1, 0.5))
            .block(GTOBlocks.COLD_ICE_CASING)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .aisle("AAAAA", " BBB ", " BGB ", " BBB ", "AAAAA")
                    .aisle("AAAAA", "BE EB", "BE EB", "BE EB", "AAAAA")
                    .aisle("AAAAA", " F F ", " F F ", " F F ", "ACHCA")
                    .aisle("AAAAA", "BE EB", "BE EB", "BE EB", "ACCCA")
                    .aisle("AAAAA", "D   D", "D   D", "D   D", "ACCCA")
                    .aisle("AAAAA", "BE EB", "BE EB", "BE EB", "ACCCA")
                    .aisle("AAAAA", " F F ", " F F ", " F F ", "ACHCA")
                    .aisle("AAAAA", "BE EB", "BE EB", "BE EB", "AAAAA")
                    .aisle("AAAAA", " BBB ", " BBB ", " BBB ", "AAAAA")
                    .where('A', blocks(GTBlocks.CASING_ALUMINIUM_FROSTPROOF.get()))
                    .where('B', blocks(GTOBlocks.COLD_ICE_CASING.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('C', blocks(GTOBlocks.COLD_ICE_CASING.get()))
                    .where('D', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Aluminium)))
                    .where('F', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                    .where('G', controller(definition))
                    .where('H', abilities(MUFFLER))
                    .where(' ', any())
                    .build())
            .addSubPattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("    AAA", "    BBB", "    BBB", "    DDD", "    DDD", "    DDD", "    DDD")
                    .aisle("   EAAA", "   EDFB", "   EDFB", "   EDFD", "    DFD", "    DFD", "    DDD")
                    .aisle("   FAAA", "   FDDB", "  FFDDB", "   EDDD", "    DDD", "    DDD", "    DDD")
                    .aisle("   EGGG", "   EG H", "   EG H", "   EGGG", "       ", "       ", "       ")
                    .aisle("    GGG", "    G H", "    G H", "    GGG", "       ", "       ", "       ")
                    .aisle("   EGGG", "   EG H", "   EG H", "   EGGG", "       ", "       ", "       ")
                    .aisle("   FAAA", "   FDDB", "  FFDDB", "   EDDD", "    DDD", "    DDD", "    DDD")
                    .aisle("   EAAA", "   EDFB", "   EDFB", "   EDFD", "    DFD", "    DFD", "    DDD")
                    .aisle("    AAA", "    BBB", "C   BBB", "    DDD", "    DDD", "    DDD", "    DDD")
                    .where('A', blocks(GTBlocks.CASING_ALUMINIUM_FROSTPROOF.get()))
                    .where('B', blocks(GTOBlocks.COLD_ICE_CASING.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(6))
                            .or(abilities(GTOPartAbility.ACCELERATE_HATCH).setMaxGlobalLimited(1)))
                    .where('C', controller(definition))
                    .where('D', blocks(GTOBlocks.COLD_ICE_CASING.get()))
                    .where('E', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Naquadah)))
                    .where('F', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                    .where('G', blocks(GTOBlocks.NAQUADAH_ALLOY_CASING.get()))
                    .where('H', blocks(GCYMBlocks.HEAT_VENT.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/cold_ice_casing"), GTCEu.id("block/multiblock/vacuum_freezer"))
            .recoveryStacks((machine, recipe) -> machine.getLevel() instanceof ServerLevel l && l.random.nextFloat() < 0.1f ?
                    ModItems.ICE_SHARD.get().getDefaultInstance() :
                    ChemicalHelper.get(TagPrefix.dust, GTMaterials.Ice))
            .register();

    public static final MultiblockMachineDefinition BEDROCK_DRILLING_RIG = multiblock("bedrock_drilling_rig", "基岩钻机", BedrockDrillingRigMachine::new)
            .noneRotation()
            .recipeTypes(GTORecipeTypes.BEDROCK_DRILLING_RIG_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getBedrockDrillingRigTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getBedrockDrillingRigTooltips().getSupplier())
            .overclock()
            .block(GTOBlocks.ECHO_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('c', blocks(GTOBlocks.ECHO_CASING.get())
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('a', blocks(GTOBlocks.OXIDATION_RESISTANT_HASTELLOY_N_MECHANICAL_CASING.get()))
                    .where('b', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.HastelloyX)))
                    .where('d', blocks(GTBlocks.CASING_TITANIUM_PIPE.get()))
                    .where('e', blocks(GCYMBlocks.MOLYBDENUM_DISILICIDE_COIL_BLOCK.get()))
                    .where('f', blocks(GTOBlocks.AMPROSIUM_GEARBOX.get()))
                    .where('g', blocks(GTOBlocks.MACHINE_CASING_GRINDING_HEAD.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/echo_casing"), GTCEu.id("block/multiblock/cleanroom"))
            .register();

    public static final MultiblockMachineDefinition NYARLATHOTEPS_TENTACLE = multiblock("nyarlathoteps_tentacle", "奈亚拉托提普之触", CoilCrossRecipeMultiblockMachine::createCoilParallel)
            .allRotation()
            .recipeTypes(SUPRACHRONAL_ASSEMBLY_LINE_RECIPES, ASSEMBLY_LINE_RECIPES, CIRCUIT_ASSEMBLY_LINE_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getNyarlathotepsTentacleTooltips().getSupplier())
            .coilParallelTooltips()
            .laserTooltips()
            .multipleRecipesTooltips()
            .block(GTOBlocks.MOLECULAR_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.LEFT, RelativeDirection.UP, RelativeDirection.FRONT)
                    .where('A', blocks(GTOBlocks.MOLECULAR_CASING.get())
                            .or(GTOPredicates.autoThreadLaserAbilities(definition.getRecipeTypes()))
                            .or(abilities(OPTICAL_DATA_RECEPTION).setExactLimit(1)))
                    .where('B', blocks(GTOBlocks.ADVANCED_FUSION_COIL.get()))
                    .where('C', blocks(GTOBlocks.LASER_CASING.get()))
                    .where('D', blocks(GTOBlocks.URUIUM_COIL_BLOCK.get()))
                    .where('E', blocks(GTOBlocks.HYPER_CORE.get()))
                    .where('F', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.Amprosium)))
                    .where('G', blocks(GTOBlocks.SPACETIME_ASSEMBLY_LINE_CASING.get()))
                    .where('H', blocks(GTOBlocks.EXTREME_DENSITY_CASING.get()))
                    .where('I', blocks(GTBlocks.FUSION_GLASS.get()))
                    .where('J', blocks(GTOBlocks.LASER_COOLING_CASING.get()))
                    .where('K', blocks(GTOBlocks.QUANTUM_GLASS.get()))
                    .where('L', blocks(GTOBlocks.NAQUADAH_ALLOY_CASING.get()))
                    .where('M', blocks(GTOBlocks.SPS_CASING.get()))
                    .where('N', blocks(GTOBlocks.SPACETIME_ASSEMBLY_LINE_UNIT.get()))
                    .where('O', blocks(GTOBlocks.MOLECULAR_CASING.get()))
                    .where('P', blocks(GTOBlocks.CONTAINMENT_FIELD_GENERATOR.get()))
                    .where('Q', heatingCoils())
                    .where('R', blocks(GTBlocks.FILTER_CASING_STERILE.get()))
                    .where('S', blocks(GTOBlocks.ELECTRON_PERMEABLE_AMPROSIUM_COATED_GLASS.get()))
                    .where('T', blocks(GTOBlocks.HOLLOW_CASING.get()))
                    .where('U', blocks(GTOBlocks.AMPROSIUM_ACTIVE_CASING.get()))
                    .where('V', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.Mithril)))
                    .where('W', blocks(RegistriesUtils.getBlock("gtceu:ruby_block")))
                    .where('X', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                    .where('Y', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Trinium)))
                    .where('Z', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                    .where('[', blocks(GTOBlocks.DIMENSIONAL_BRIDGE_CASING.get()))
                    .where('+', blocks(GTOBlocks.RESTRAINT_DEVICE.get()))
                    .where(']', blocks(GTOBlocks.QUARK_PIPE.get()))
                    .where('^', blocks(GTOBlocks.MOLECULAR_COIL.get()))
                    .where('_', blocks(GTOBlocks.DEGENERATE_RHENIUM_CONSTRAINED_CASING.get()))
                    .where('`', blocks(GTOBlocks.DIMENSIONALLY_TRANSCENDENT_CASING.get()))
                    .where('a', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/molecular_casing"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition PROCESSING_PLANT = multiblock("processing_plant", "通用工厂", ProcessingPlantMachine::new)
            .allRotation()
            .recipeTypes(GTRecipeTypes.DUMMY_RECIPES)
            .eutMultiplierTooltips(0.9)
            .durationMultiplierTooltips(0.8)
            .tooltips(GTOMachineStories.INSTANCE.getProcessingPlantTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getProcessingPlantTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(
                    h -> h.addLines("自ULV起，电压每高出1级，获得的并行数+2", "From ULV, each voltage tier increases the obtained parallelism by 2"),
                    c -> c.addCommentLines("公式 : 2 * (tier - 0), 算去吧", "Formula: 2 * (tier - 0), go calculate it yourself")))
            .tooltips(NewDataAttributes.RECIPES_TYPE.create(ProcessingPlantMachine.getComponent()))
            .moduleTooltips(CATALYST_HATCH)
            .block(GTOBlocks.MULTI_FUNCTIONAL_CASING)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("bbb", "bbb", "bbb")
                    .aisle("bbb", "bcb", "bbb")
                    .aisle("bbb", "bab", "bbb")
                    .where('a', controller(definition))
                    .where('b', blocks(GTOBlocks.MULTI_FUNCTIONAL_CASING.get())
                            .setMinGlobalLimited(14)
                            .or(Predicates.blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                            .or(abilities(GTOPartAbility.ACCELERATE_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(IMPORT_ITEMS))
                            .or(abilities(EXPORT_ITEMS))
                            .or(abilities(IMPORT_FLUIDS))
                            .or(abilities(EXPORT_FLUIDS))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(4).setPreviewCount(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('c', GTOPredicates.integralFramework())
                    .build())
            .addSubPattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("  BBBA", "  CCCA", "  CCCA")
                    .aisle("  DDDA", "     A", "  EEEA")
                    .aisle("  BBBA", "F CCCA", "  CCCA")
                    .where('A', blocks(GTOBlocks.MULTI_FUNCTIONAL_CASING.get())
                            .or(GTOPredicates.autoIOAbilities(definition.getRecipeTypes()))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(4))
                            .or(blocks(GTOMachines.CATALYST_HATCH.get()).setMaxGlobalLimited(1))
                            .or(Predicates.blocks(ManaMachine.MANA_AMPLIFIER_HATCH.get()).setMaxGlobalLimited(1)))
                    .where('B', blocks(GTOBlocks.MULTI_FUNCTIONAL_CASING.get()))
                    .where('C', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('D', blocks(GTBlocks.CASING_STAINLESS_STEEL_GEARBOX.get()))
                    .where('E', blocks(GTBlocks.CASING_GRATE.get()))
                    .where('F', controller(definition))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/multi_functional_casing"), GTCEu.id("block/multiblock/gcym/large_assembler"))
            .register();

    public static final MultiblockMachineDefinition NANO_FORGE = multiblock("nano_forge", "纳米锻炉", NanoForgeMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.NANO_FORGE_RECIPES)
            .tooltips(GTOMachineTooltips.INSTANCE.getNanoForgeTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(
                    h -> h.addLines("机器内纳米蜂群数量，机器等级每超过配方一级，获得的并行x2", "The number of Nano Swarms in the machine; for each machine tier above the recipe tier, the obtained parallel is doubled"),
                    c -> c.addCommentLines("公式 : 纳米蜂群数量 * 2^(机器等级 - 配方等级), 算去吧", "Formula: Number of Nano Swarms * 2^(Machine Tier - Recipe Tier), do the math")))
            .laserTooltips()
            .fromSourceTooltips("GTNH")
            .block(GTOBlocks.NAQUADAH_ALLOY_CASING)
            .pattern(definition -> NanoForgeMachine.getBlockPattern(1, definition))
            .shapeInfos(definition -> {
                List<MultiblockShapeInfo> shapeInfos = new ArrayList<>();
                for (int i = 1; i < 4; i++) {
                    shapeInfos.addAll(MultiblockDefinition.getMatchingShapes(false, NanoForgeMachine.getBlockPattern(i, definition)));
                }
                return shapeInfos;
            })
            .workableCasingRenderer(GTOCore.id("block/casings/hyper_mechanical_casing"), GTCEu.id("block/multiblock/gcym/large_assembler"))
            .register();

    public static final MultiblockMachineDefinition ISA_MILL = multiblock("isa_mill", "艾萨研磨机", IsaMillMachine::new)
            .allRotation()
            .recipeTypes(GTORecipeTypes.ISA_MILL_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getIsaMillTooltips().getSupplier())
            .perfectOCTooltips()
            .perfectOverclock()
            .fromSourceTooltips("GTNH")
            .block(GTOBlocks.INCONEL_625_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.BACK, RelativeDirection.UP, RelativeDirection.RIGHT)
                    .where('~', controller(definition))
                    .where('B', blocks(GTOBlocks.INCONEL_625_CASING.get())
                            .or(Predicates.blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(4).setPreviewCount(1))
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1))
                            .or(abilities(MUFFLER).setExactLimit(1)))
                    .where('C', blocks(GTOBlocks.INCONEL_625_GEARBOX.get()))
                    .where('A', blocks(GTOBlocks.INCONEL_625_PIPE.get()))
                    .where('D', blocks(GTOMachines.GRIND_BALL_HATCH.get()))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/inconel_625_casing"), GTCEu.id("block/multiblock/gcym/large_maceration_tower"))
            .recoveryStacks((m, r) -> {
                if (r == null) return ItemStack.EMPTY;
                return ItemUtils.getFirstSized((Ingredient) r.outputs.get(ItemRecipeCapability.CAP).getFirst().content).copyWithCount(1);
            })
            .register();

    public static final MultiblockMachineDefinition NEUTRON_ACTIVATOR = multiblock("neutron_activator", "中子活化器", NeutronActivatorMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getNeutronActivatorTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getNeutronActivatorTooltips().getSupplier())
            .parallelizableTooltips()
            .fromSourceTooltips("GTNH")
            .recipeTypes(GTORecipeTypes.NEUTRON_ACTIVATOR_RECIPES)
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.RIGHT, RelativeDirection.BACK, RelativeDirection.UP)
                    .aisle("AAGAA", "ADDDA", "ADDDA", "ADDDA", "AAAAA")
                    .aisle("B   B", " EEE ", " EFE ", " EEE ", "B   B").setRepeatable(4, 100)
                    .aisle("CCCCC", "CDDDC", "CDDDC", "CDDDC", "CCCCC")
                    .where('G', controller(definition))
                    .where('A', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(Predicates.blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                            .or(blocks(GTOMachines.NEUTRON_SENSOR.get()).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(EXPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(GTOPartAbility.NEUTRON_ACCELERATOR).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Tungsten)))
                    .where('C', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(2).setPreviewCount(1)))
                    .where('D', blocks(GTOBlocks.PROCESS_MACHINE_CASING.get()))
                    .where('E', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('F', GTOPredicates.countBlock("SpeedPipe",
                            GTOBlocks.SPEEDING_PIPE.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition HEAT_EXCHANGER = multiblock("heat_exchanger", "热交换机", HeatExchangerMachine::new)
            .allRotation()
            .tooltips(GTOMachineStories.INSTANCE.getHeatExchangerTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getHeatExchangerTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.HEAT_EXCHANGER_RECIPES)
            .block(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('S', controller(definition))
                    .where('A',
                            blocks(GTBlocks.CASING_TUNGSTENSTEEL_ROBUST.get()).setMinGlobalLimited(98)
                                    .or(autoAbilities(definition.getRecipeTypes()))
                                    .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('C', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                    .where('B', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('D', frames(GTMaterials.HSSG))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_robust_tungstensteel"),
                    GTCEu.id("block/multiblock/implosion_compressor"))
            .register();

    public static final MultiblockMachineDefinition INFINITY_FLUID_DRILLING_RIG = multiblock("infinity_fluid_drilling_rig", "无尽流体钻机", holder -> new INFFluidDrillMachine(holder, GTValues.ZPM, 256))
            .allRotation()
            .recipeTypes(GTRecipeTypes.DUMMY_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getInfinityFluidDrillingRigTooltips().getSupplier())
            .tooltipsKey("gtceu.machine.fluid_drilling_rig.description")
            .tooltips(NewDataAttributes.EMPTY_WITH_BAR.create(c -> c.addLines("损耗率 : 0", "Deplition Rate : 0", s -> s.setColor(0xEED8AE))))
            .tooltips(NewDataAttributes.VOLTAGE.create(c -> c.addLines(GTValues.VNF[GTValues.ZPM] + " -> " + GTValues.VNF[GTValues.UV])))
            .tooltips(NewDataAttributes.MULTIPLY.create(c -> c.addLines("256x -> 384x")))
            .block(GTOBlocks.IRIDIUM_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('S', controller(definition))
                    .where('X', blocks(GTOBlocks.IRIDIUM_CASING.get()).setMinGlobalLimited(3)
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(EXPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1)))
                    .where('C', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                    .where('F', frames(GTMaterials.Ruridit))
                    .where('#', any())
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/iridium_casing"), GTCEu.id("block/multiblock/fluid_drilling_rig"))
            .register();

    public static final MultiblockMachineDefinition ADVANCED_ASSEMBLY_LINE = multiblock("advanced_assembly_line", "进阶装配线", AdvancedAssemblyLineMachine::new)
            .allRotation()
            .recipeTypes(GTRecipeTypes.ASSEMBLY_LINE_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getAdvancedAssemblyLineTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getAdvancedAssemblyLineTooltips().getSupplier())
            .parallelizableTooltips()
            .laserTooltips()
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> FactoryBlockPattern.start(definition, RelativeDirection.BACK, RelativeDirection.UP, RelativeDirection.RIGHT)
                    .aisle("FIF", "RTR", "SAG", "#Y#")
                    .aisle("FIF", "RTR", "DAG", "#Y#").setRepeatable(3, 15)
                    .aisle("FOF", "RTR", "DAG", "#Y#")
                    .where('S', controller(definition))
                    .where('F', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(4).setPreviewCount(1))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1)))
                    .where('O', abilities(EXPORT_ITEMS).addTooltips(Component.translatable("gtceu.multiblock.pattern.location_end")))
                    .where('Y', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(INPUT_LASER).setMaxGlobalLimited(2)))
                    .where('I', abilities(GTOPartAbility.ITEMS_INPUT))
                    .where('G', blocks(GTBlocks.CASING_GRATE.get()))
                    .where('D', blocks(GTBlocks.CASING_GRATE.get())
                            .or(abilities(OPTICAL_DATA_RECEPTION).setExactLimit(1)))
                    .where('A', blocks(GTBlocks.CASING_ASSEMBLY_CONTROL.get()))
                    .where('R', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()))
                    .where('T', blocks(GTOBlocks.ADVANCED_ASSEMBLY_LINE_UNIT.get()))
                    .where('#', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/assembly_line"))
            .register();

    public static final MultiblockMachineDefinition FISSION_REACTOR = multiblock("fission_reactor", "裂变反应堆", FissionReactorMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTORecipeTypes.FISSION_REACTOR_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getFissionReactorTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getFissionReactorTooltips().getSupplier())
            .specialParallelizableTooltips()
            .tooltips(NewDataAttributes.ALLOW_PARALLEL_NUMBER.create(CNEN.create("等于燃料组件数量", "Number of Fuel Components")).get().toArray(new Component[0]))
            .block(GTOBlocks.FISSION_REACTOR_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTOBlocks.FISSION_REACTOR_CASING.get())
                            .or(Predicates.blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                            .or(blocks(GTOMachines.HEAT_SENSOR.get()).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1))
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(EXPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(IMPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1)))
                    .where('B', blocks(GTBlocks.CASING_LAMINATED_GLASS.get()).or(blocks(GTOBlocks.FISSION_REACTOR_CASING.get())))
                    .where('C', air().or(GTOPredicates.fissionComponent()))
                    .build())
            .workableCasingRenderer(GTOCore.id("block/casings/fission_reactor_casing"), GTCEu.id("block/multiblock/fusion_reactor"))
            .register();

    public static final MultiblockMachineDefinition SPACE_ELEVATOR = multiblock("space_elevator", "太空电梯", SpaceElevatorMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTRecipeTypes.DUMMY_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getSpaceElevatorTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getSpaceElevatorTooltips().getSupplier())
            .fromSourceTooltips("GTNH")
            .block(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING)
            .pattern(definition -> MultiBlockFileReader.start(definition, RelativeDirection.RIGHT, RelativeDirection.UP, RelativeDirection.BACK)
                    .where('~', controller(definition))
                    .where('A', blocks(GTOBlocks.HIGH_STRENGTH_CONCRETE.get()))
                    .where('B', blocks(GTOBlocks.SPACE_ELEVATOR_INTERNAL_SUPPORT.get()))
                    .where('C', blocks(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING.get()))
                    .where('D', blocks(GTOBlocks.SPACE_ELEVATOR_SUPPORT.get()))
                    .where('E', frames(GTMaterials.Neutronium))
                    .where('F', blocks(GTOBlocks.SPACE_ELEVATOR_MODULE_BASE.get()))
                    .where('G', blocks(GTOBlocks.HIGH_STRENGTH_CONCRETE.get()).or(blocks(GTOBlocks.MODULE_CONNECTOR.get()).setPreviewCount(1)))
                    .where('H', GTOPredicates.tierBlock(SEPMMAP, POWER_MODULE_TIER))
                    .where('I', air())
                    .where('J', blocks(GTOBlocks.SPACE_ELEVATOR_POWER_CORE.get()))
                    .where('X', blocks(GTOBlocks.SPACE_ELEVATOR_MECHANICAL_CASING.get())
                            .or(abilities(GTOPartAbility.ITEMS_INPUT).setExactLimit(1))
                            .or(abilities(INPUT_ENERGY).setExactLimit(1))
                            .or(abilities(COMPUTATION_DATA_RECEPTION).setExactLimit(1)))
                    .where(' ', any())
                    .build())
            .renderer(SpaceElevatorRenderer::new)
            .hasTESR(true)
            .register();

    public static final MultiblockMachineDefinition SLAUGHTERHOUSE = multiblock("slaughterhouse", "工业屠宰场", SlaughterhouseMachine::new)
            .nonYAxisRotation()
            .tooltipsSupplier(GTOMachineStories.INSTANCE.getSlaughterhouseTooltips().getSupplier())
            .tooltipsSupplier(GTOMachineTooltips.INSTANCE.getSlaughterhouseTooltips().getSupplier())
            .recipeTypes(GTRecipeTypes.DUMMY_RECIPES)
            .block(GTBlocks.CASING_STEEL_SOLID)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('~', controller(definition))
                    .where('A', blocks(GTBlocks.CASING_STEEL_SOLID.get())
                            .or(Predicates.blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(2).setPreviewCount(1))
                            .or(abilities(EXPORT_ITEMS).setMaxGlobalLimited(4).setPreviewCount(1))
                            .or(abilities(EXPORT_FLUIDS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(IMPORT_ITEMS).setMaxGlobalLimited(1).setPreviewCount(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('B', GTOPredicates.glass())
                    .where('C', blocks(GTBlocks.CASING_STEEL_GEARBOX.get()))
                    .where('D', blocks(Blocks.IRON_BARS))
                    .where('E', blocks(GTBlocks.FIREBOX_STEEL.get()))
                    .where(' ', air())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/solid/machine_casing_solid_steel"), GTCEu.id("block/multiblock/gcym/large_cutter"))
            .register();

    public static final MultiblockMachineDefinition[] FUSION_REACTOR = registerTieredMultis("fusion_reactor", tier -> "核聚变反应堆控制电脑 MK-" + FormattingUtil.toRomanNumeral(tier - 5),
            FusionReactorMachine::new, (tier, builder) -> builder
                    .allRotation()
                    .langValue("Fusion Reactor Computer MK %s".formatted(FormattingUtil.toRomanNumeral(tier - 5)))
                    .recipeTypes(GTRecipeTypes.FUSION_RECIPES)
                    .tooltipsKey("gtceu.machine.fusion_reactor.capacity", FusionReactorMachine.calculateEnergyStorageFactor(tier, 16) / 1000000L)
                    .tooltipsKey("gtceu.machine.fusion_reactor.overclocking")
                    .tooltipsKey("gtocore.machine.%s_fusion_reactor.description".formatted(GTValues.VN[tier].toLowerCase(Locale.ROOT)))
                    .block(() -> FusionCasings.getCasingState(tier))
                    .pattern(definition -> {
                        TraceabilityPredicate casing = blocks(FusionCasings.getCasingState(tier));
                        return FactoryBlockPattern.start(definition)
                                .aisle("###############", "######OGO######", "###############")
                                .aisle("######ICI######", "####GGAAAGG####", "######ICI######")
                                .aisle("####CC###CC####", "###EAAOGOAAE###", "####CC###CC####")
                                .aisle("###C#######C###", "##EKEG###GEKE##", "###C#######C###")
                                .aisle("##C#########C##", "#GAE#######EAG#", "##C#########C##")
                                .aisle("##C#########C##", "#GAG#######GAG#", "##C#########C##")
                                .aisle("#I###########I#", "OAO#########OAO", "#I###########I#")
                                .aisle("#C###########C#", "GAG#########GAG", "#C###########C#")
                                .aisle("#I###########I#", "OAO#########OAO", "#I###########I#")
                                .aisle("##C#########C##", "#GAG#######GAG#", "##C#########C##")
                                .aisle("##C#########C##", "#GAE#######EAG#", "##C#########C##")
                                .aisle("###C#######C###", "##EKEG###GEKE##", "###C#######C###")
                                .aisle("####CC###CC####", "###EAAOGOAAE###", "####CC###CC####")
                                .aisle("######ICI######", "####GGAAAGG####", "######ICI######")
                                .aisle("###############", "######OSO######", "###############")
                                .where('S', controller(definition))
                                .where('G', blocks(GTBlocks.FUSION_GLASS.get()).or(casing))
                                .where('E', casing.or(
                                        blocks(INPUT_ENERGY.getBlockRange(tier, GTValues.UEV).toArray(Block[]::new))
                                                .setMinGlobalLimited(1).setPreviewCount(16)))
                                .where('C', casing)
                                .where('K', blocks(FusionCasings.getCoilState(tier)))
                                .where('O', casing.or(abilities(EXPORT_FLUIDS)))
                                .where('A', air())
                                .where('I', casing.or(abilities(IMPORT_FLUIDS).setMinGlobalLimited(2)))
                                .where('#', any())
                                .build();
                    })
                    .shapeInfos((controller) -> {
                        List<MultiblockShapeInfo> shapeInfos = new ArrayList<>();

                        MultiblockShapeInfo.ShapeInfoBuilder baseBuilder = MultiblockShapeInfo.builder()
                                .aisle("###############", "######NMN######", "###############")
                                .aisle("######DCD######", "####GG###GG####", "######UCU######")
                                .aisle("####CC###CC####", "###w##SGS##e###", "####CC###CC####")
                                .aisle("###C#######C###", "##nKsG###GsKn##", "###C#######C###")
                                .aisle("##C#########C##", "#G#e#######w#G#", "##C#########C##")
                                .aisle("##C#########C##", "#G#G#######G#G#", "##C#########C##")
                                .aisle("#D###########D#", "W#E#########W#E", "#U###########U#")
                                .aisle("#C###########C#", "G#G#########G#G", "#C###########C#")
                                .aisle("#D###########D#", "W#E#########W#E", "#U###########U#")
                                .aisle("##C#########C##", "#G#G#######G#G#", "##C#########C##")
                                .aisle("##C#########C##", "#G#e#######w#G#", "##C#########C##")
                                .aisle("###C#######C###", "##sKnG###GnKs##", "###C#######C###")
                                .aisle("####CC###CC####", "###w##NGN##e###", "####CC###CC####")
                                .aisle("######DCD######", "####GG###GG####", "######UCU######")
                                .aisle("###############", "######SGS######", "###############")
                                .where('M', controller, Direction.NORTH)
                                .where('C', FusionCasings.getCasingState(tier))
                                .where('G', GTBlocks.FUSION_GLASS.get())
                                .where('K', FusionCasings.getCoilState(tier))
                                .where('W', GTMachines.FLUID_EXPORT_HATCH[tier], Direction.WEST)
                                .where('E', GTMachines.FLUID_EXPORT_HATCH[tier], Direction.EAST)
                                .where('S', GTMachines.FLUID_EXPORT_HATCH[tier], Direction.SOUTH)
                                .where('N', GTMachines.FLUID_EXPORT_HATCH[tier], Direction.NORTH)
                                .where('w', GTMachines.ENERGY_INPUT_HATCH[tier], Direction.WEST)
                                .where('e', GTMachines.ENERGY_INPUT_HATCH[tier], Direction.EAST)
                                .where('s', GTMachines.ENERGY_INPUT_HATCH[tier], Direction.SOUTH)
                                .where('n', GTMachines.ENERGY_INPUT_HATCH[tier], Direction.NORTH)
                                .where('U', GTMachines.FLUID_IMPORT_HATCH[tier], Direction.UP)
                                .where('D', GTMachines.FLUID_IMPORT_HATCH[tier], Direction.DOWN)
                                .where('#', Blocks.AIR.defaultBlockState());

                        shapeInfos.add(baseBuilder.shallowCopy()
                                .where('G', FusionCasings.getCasingState(tier))
                                .build());
                        shapeInfos.add(baseBuilder.build());
                        return shapeInfos;
                    })
                    .renderer(() -> new FusionReactorRenderer(FusionCasings.getCasingType(tier).getTexture(),
                            GTCEu.id("block/multiblock/fusion_reactor")))
                    .hasTESR(true)
                    .register(),
            GTValues.UHV, GTValues.UEV);

    public static final MultiblockMachineDefinition KUANGBIAO_ONE_GIANT_NUCLEAR_FUSION_REACTOR = multiblock("luv_kuangbiao_one_giant_nuclear_fusion_reactor", "狂飙一号巨型聚变反应堆控制电脑",
            AdvancedFusionReactorMachine::new)
            .nonYAxisRotation()
            .langValue("Advanced Fusion Reactor MK-I")
            .recipeTypes(GTRecipeTypes.FUSION_RECIPES)
            .tooltips(GTOMachineStories.INSTANCE.getKuangbiaoGiantNuclearFusionReactorTooltips().getSupplier())
            .tooltips(GTOMachineTooltipsA.INSTANCE.getKuangbiaoGiantNuclearFusionReactorTooltips().getSupplier())
            .tooltips(GTOMachineTooltipsA.INSTANCE.getKuangbiaoGiantNuclearFusionReactorEnergyStorageTooltip().invoke(FusionReactorMachine.calculateEnergyStorageFactor(LuV, 16) / 1000000L).getSupplier())
            .parallelizableTooltips()
            .moduleTooltips(THREAD_HATCH, OVERCLOCK_HATCH)
            .laserTooltips()
            .block(() -> FusionCasings.getCasingState(LuV))
            .pattern(definition -> {
                TraceabilityPredicate casing = blocks(FusionCasings.getCasingState(LuV));
                return MultiBlockFileReader.builder()
                        .LUF(RelativeDirection.FRONT, RelativeDirection.UP, RelativeDirection.RIGHT)
                        .name("kuangbiao1")
                        .startBuild(definition)
                        .where('A', blocks(GCYMBlocks.CASING_NONCONDUCTING.get()))
                        .where('B', blocks(GTOBlocks.HIGH_STRENGTH_CONCRETE.get()))
                        .where('C', frames(GTMaterials.Tungsten))
                        .where('D', casing.or(abilities(IMPORT_FLUIDS).setPreviewCount(16))
                                .or(blocks(GTMachines.CONTROL_HATCH.get()).setMaxGlobalLimited(1).setPreviewCount(0))
                                .or(abilities(EXPORT_FLUIDS).setPreviewCount(16))
                                .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                                .or(abilities(INPUT_LASER).setMaxGlobalLimited(16, 16))
                                .or(Predicates.abilities(GTOPartAbility.ACCELERATE_HATCH).setMaxGlobalLimited(1)))
                        .where('E', casing)
                        .where('F', blocks(FusionCasings.getFrameState(LuV)))
                        .where('G', blocks(GTOBlocks.STRENGTHEN_THE_BASE_BLOCK.get()))
                        .where('H', blocks(FusionCasings.getCompressedCoilState(LuV)))
                        .where('I', blocks(GTOBlocks.PBI_RADIATION_RESISTANT_MECHANICAL_ENCLOSURE.get()))
                        .where('J', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where('K', blocks(GTBlocks.FUSION_GLASS.get()))
                        .where('L', blocks(GTOBlocks.FISSION_REACTOR_CASING.get()))
                        .where('M', controller(definition))
                        .where(' ', any())
                        .build();
            })
            .renderer(() -> new AdvancedFusionReactorRenderer(FusionCasings.getCasingType(LuV).getTexture(), GTCEu.id("block/multiblock/fusion_reactor")))
            .hasTESR(true)
            .register();

    public static final MultiblockMachineDefinition INCUBATOR = multiblock("incubator", "培养缸", IncubatorMachine::new)
            .nonYAxisRotation()
            .tooltips(NewDataAttributes.RUNTIME_REQUIREMENT.create(
                    c -> c.addLines("玻璃等级决定配方等级上限",
                            "The glass casing tier determines the upper limit of recipe tier")))
            .tooltips(GTOMachineStories.INSTANCE.getCulturingTankTooltips().getSupplier())
            .tooltips(GTOMachineTooltips.INSTANCE.getCulturingTankTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.INCUBATOR_RECIPES)
            .overclock()
            .block(GTBlocks.PLASTCRETE)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('a', controller(definition))
                    .where('b', blocks(GTBlocks.PLASTCRETE.get()).setMinGlobalLimited(40)
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(blocks(GTOMachines.RADIATION_HATCH.get()).setMaxGlobalLimited(2))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('c', blocks(Blocks.SPONGE))
                    .where('d', GTOPredicates.glass())
                    .where('e', cleanroomFilters())
                    .where(' ', air())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/cleanroom/plascrete"), GTCEu.id("block/multiblock/gcym/large_maceration_tower"))
            .register();

    public static final MultiblockMachineDefinition LARGE_INCUBATOR = multiblock("large_incubator", "大型培养缸", IncubatorMachine::new)
            .nonYAxisRotation()
            .tooltips(NewDataAttributes.RUNTIME_REQUIREMENT.create(
                    c -> c.addLines("玻璃等级决定配方等级上限",
                            "The glass casing tier determines the upper limit of recipe tier")))
            .tooltips(GTOMachineTooltips.INSTANCE.getLargeCulturingTankTooltips().getSupplier())
            .tooltips(GTOMachineStories.INSTANCE.getLargeCulturingTankTooltips().getSupplier())
            .recipeTypes(GTORecipeTypes.INCUBATOR_RECIPES)
            .parallelizableTooltips()
            .parallelizableOverclock()
            .block(GTBlocks.PLASTCRETE)
            .pattern(definition -> MultiBlockFileReader.start(definition)
                    .where('A', blocks(GTOBlocks.OXIDATION_RESISTANT_HASTELLOY_N_MECHANICAL_CASING.get()))
                    .where('B', blocks(GTBlocks.PLASTCRETE.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(blocks(GTOMachines.RADIATION_HATCH.get()).setMaxGlobalLimited(8))
                            .or(abilities(PARALLEL_HATCH).setMaxGlobalLimited(1))
                            .or(abilities(MAINTENANCE).setExactLimit(1)))
                    .where('C', controller(definition))
                    .where('D', GTOPredicates.glass())
                    .where('E', cleanroomFilters())
                    .where('F', blocks(Blocks.SPONGE))
                    .where('G', blocks(GTBlocks.PLASTCRETE.get()))
                    .where('H', blocks(GTBlocks.CASING_POLYTETRAFLUOROETHYLENE_PIPE.get()))
                    .where(' ', any())
                    .build())
            .workableCasingRenderer(GTCEu.id("block/casings/cleanroom/plascrete"), GTCEu.id("block/multiblock/gcym/large_maceration_tower"))
            .register();

    public static final MultiblockMachineDefinition DISSOLVING_TANK = multiblock("dissolving_tank", "溶解罐", DissolvingTankMachine::new)
            .nonYAxisRotation()
            .tooltips(GTOMachineStories.INSTANCE.getDissolvingTankTooltips().getSupplier())
            .tooltips(GTOMachineTooltipsA.INSTANCE.getDissolvingTankTooltips().getSupplier())
            .parallelizableTooltips()
            .moduleTooltips(ACCELERATE_HATCH)
            .recipeTypes(GTORecipeTypes.DISSOLUTION_TREATMENT_RECIPES)
            .block(GTBlocks.CASING_STAINLESS_CLEAN)
            .pattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("X###X", "OOOOO", "XGGGX", "XGGGX", "#XXX#")
                    .aisle("#####", "OKKKO", "G###G", "G###G", "XXXXX")
                    .aisle("#####", "OKKKO", "G###G", "G###G", "XXXXX")
                    .aisle("#####", "OKKKO", "G###G", "G###G", "XXXXX")
                    .aisle("X###X", "OOSOO", "XGGGX", "XGGGX", "#XXX#")
                    .where('S', controller(definition))
                    .where('X', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('K', blocks(GTBlocks.CASING_INVAR_HEATPROOF.get()))
                    .where('O', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(autoAbilities(definition.getRecipeTypes()))
                            .or(autoAbilities(true, false, true)))
                    .where('G', blocks(GTBlocks.CASING_TEMPERED_GLASS.get()))
                    .where('#', any())
                    .build())
            .addSubPattern(definition -> FactoryBlockPattern.start(definition)
                    .aisle("BEBEB", "BBBBB", "BHHHB", "BBBBB", "BBBBB")
                    .aisle("BEBEB", "CAIAC", "CIIIC", "CAIAC", "BCCCB")
                    .aisle("BFBFB", "BFIFB", "BIIIB", "BFIFB", "BBBBB")
                    .aisle(" GGG ", "DAIAD", "DIIID", "DAIAD", " DDD ")
                    .aisle(" GGG ", "DAIAD", "DIIID", "DAIAD", " DDD ")
                    .aisle("BFBFB", "BFIFB", "BIIIB", "BFIFB", "BBBBB")
                    .aisle("BEBEB", "CAIAC", "CIIIC", "CAIAC", "BCCCC")
                    .aisle("BEBEB", "BBBBB", "BHHHB", "BBBBB", "BBBBB")
                    .aisle(" EAE ", "     ", "     ", "     ", "     ")
                    .aisle("AEAEA", "     ", "     ", "     ", "     ")
                    .aisle("AEAEA", "     ", "     ", "     ", "     ")
                    .aisle("AEAEA", "     ", "     ", "     ", "     ")
                    .aisle(" AAA ", "  J  ", "     ", "     ", "     ")
                    .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.UltraLightweightCompositeSteel)))
                    .where('B', blocks(GTOBlocks.STAINLESS_STEEL_CORROSION_RESISTANT_CASING.get()))
                    .where('C', blocks(GTOBlocks.PRESSURE_RESISTANT_HOUSING_MECHANICAL_BLOCK.get()))
                    .where('D', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get())
                            .or(abilities(INPUT_ENERGY).setMaxGlobalLimited(6))
                            .or(abilities(GTOPartAbility.ACCELERATE_HATCH).setMaxGlobalLimited(1)))
                    .where('E', blocks(GTOBlocks.CHEMICAL_CORROSION_RESISTANT_PIPE_CASING.get()))
                    .where('F', blocks(GTOBlocks.IRIDIUM_PIPE_CASING.get()))
                    .where('G', blocks(GTBlocks.CASING_STAINLESS_CLEAN.get()))
                    .where('H', blocks(GTBlocks.HERMETIC_CASING_LuV.get()))
                    .where('I', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                    .where('J', controller(definition))
                    .where(' ', any())
                    .build())
            .renderer(FluidRenderer.create(GTCEu.id("block/casings/solid/machine_casing_clean_stainless_steel"), GTCEu.id("block/multiblock/generator/large_gas_turbine")))
            .hasTESR(true)
            .register();

    public static final MultiblockMachineDefinition GOD_FORGE = multiblock("god_forge", "诸神之锻炉", GodForgeMachine::new)
            .nonYAxisRotation()
            .recipeTypes(GTRecipeTypes.DUMMY_RECIPES)
            .fromSourceTooltips("GTNH")
            .block(GTOBlocks.TRANSCENDENTALLY_AMPLIFIED_MAGNETIC_CONFINEMENT_CASING)
            .pattern(GodForgeMachine::getBlockPattern)
            .renderer(GodforgeRenderer::new)
            .hasTESR(true)
            .register();

    static {
        List<Function<MultiblockMachineDefinition, BlockPattern>> KUANGBIAO_subs = List.of(
                def -> MultiBlockFileReader.builder().name("kuangbiao2").startBuild(def)
                        .where('A', controller(def))
                        .where('B', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Ultimet)))
                        .where('C', blocks(GTOBlocks.COBALT_OXIDE_CERAMIC_STRONG_THERMALLY_CONDUCTIVE_MECHANICAL_BLOCK.get()))
                        .where('D', blocks(GTOBlocks.HIGH_PRESSURE_PIPE_CASING.get()))
                        .where('E', blocks(GCYMBlocks.CASING_NONCONDUCTING.get()))
                        .where('F', blocks(GTOBlocks.HYPER_MECHANICAL_CASING.get()))
                        .where('G', blocks(GTOBlocks.ANTIFREEZE_HEATPROOF_MACHINE_CASING.get()))
                        .where('H', blocks(GCYMBlocks.HEAT_VENT.get()))
                        .where('I', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                        .where('J', blocks(GTOBlocks.BORON_CARBIDE_CERAMIC_RADIATION_RESISTANT_MECHANICAL_CUBE.get()))
                        .where('K', blocks(GTBlocks.CASING_TUNGSTENSTEEL_PIPE.get()))
                        .where('L', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Duranium)))
                        .where('M', blocks(GTOBlocks.RADIATION_ABSORBENT_CASING.get()))
                        .where('N', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                        .where('O', blocks(GTBlocks.FUSION_CASING_MK2.get()))
                        .where('P', blocks(GTOBlocks.COMPRESSED_FUSION_COIL.get()))
                        .where('Q', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                        .where('R', blocks(GTOBlocks.LASER_CASING.get()))
                        .where('S', blocks(GTBlocks.FUSION_GLASS.get()))
                        .where('T', blocks(GTOBlocks.MAGTECH_CASING.get()))
                        .where('U', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where(' ', any())
                        .build(),
                def -> MultiBlockFileReader.builder().name("kuangbiao3").startBuild(def)
                        .where('A', blocks(GTBlocks.FUSION_CASING_MK3.get()))
                        .where('B', blocks(GTOBlocks.HYPER_MECHANICAL_CASING.get()))
                        .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Tritanium)))
                        .where('D', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                        .where('E', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                        .where('F', blocks(GTOBlocks.ADVANCED_COMPRESSED_FUSION_COIL.get()))
                        .where('G', blocks(GTOBlocks.OPTICAL_RESONANCE_CHAMBER.get()))
                        .where('H', blocks(GTOBlocks.LASER_CASING.get()))
                        .where('I', blocks(GTBlocks.CASING_EXTREME_ENGINE_INTAKE.get()))
                        .where('J', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Naquadria)))
                        .where('K', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where('L', blocks(GTBlocks.FUSION_GLASS.get()))
                        .where('M', blocks(GCYMBlocks.CASING_LASER_SAFE_ENGRAVING.get()))
                        .where('N', controller(def))
                        .where('O', blocks(GTOBlocks.NAQUADAH_ALLOY_CASING.get()))
                        .where('P', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                        .where('Q', blocks(GTOBlocks.TITANIUM_NITRIDE_CERAMIC_IMPACT_RESISTANT_MECHANICAL_BLOCK.get()))
                        .where('R', blocks(GTOBlocks.CHEMICAL_CORROSION_RESISTANT_PIPE_CASING.get()))
                        .where('S', blocks(GTBlocks.CASING_ASSEMBLY_LINE.get()))
                        .where('T', blocks(GTBlocks.CASING_POLYTETRAFLUOROETHYLENE_PIPE.get()))
                        .where('U', blocks(GCYMBlocks.CASING_NONCONDUCTING.get()))
                        .where('V', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                        .where(' ', any())
                        .build(),
                def -> MultiBlockFileReader.builder().name("kuangbiao4").startBuild(def)
                        .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Trinium)))
                        .where('B', blocks(GTOBlocks.NAQUADAH_ALLOY_CASING.get()))
                        .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Naquadah)))
                        .where('D', blocks(GTOBlocks.NEUTRONIUM_STABLE_CASING.get()))
                        .where('E', blocks(GTOBlocks.HYPER_MECHANICAL_CASING.get()))
                        .where('F', blocks(GTOBlocks.FUSION_CASING_MK4.get()))
                        .where('G', blocks(GTOBlocks.PRESSURE_CONTAINMENT_CASING.get()))
                        .where('H', blocks(GTOBlocks.STRONTIUM_CARBONATE_CERAMIC_RAY_ABSORBING_MECHANICAL_CUBE.get()))
                        .where('I', blocks(GTOBlocks.ELECTRON_PERMEABLE_AMPROSIUM_COATED_GLASS.get()))
                        .where('J', blocks(GTBlocks.COMPUTER_CASING.get()))
                        .where('K', blocks(GTBlocks.FUSION_GLASS.get()))
                        .where('L', blocks(GTOBlocks.IRIDIUM_CASING.get()))
                        .where('M', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                        .where('N', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where('O', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.Amprosium)))
                        .where('P', blocks(GTOBlocks.ACCELERATED_PIPELINE.get()))
                        .where('Q', blocks(GTOBlocks.BORON_CARBIDE_CERAMIC_RADIATION_RESISTANT_MECHANICAL_CUBE.get()))
                        .where('R', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                        .where('S', blocks(GTBlocks.BATTERY_EMPTY_TIER_II.get()))
                        .where('T', blocks(GTOBlocks.CHEMICAL_CORROSION_RESISTANT_PIPE_CASING.get()))
                        .where('U', blocks(GTOBlocks.RADIATION_ABSORBENT_CASING.get()))
                        .where('V', blocks(GTOBlocks.HIGH_STRENGTH_SUPPORT_MECHANICAL_CASING.get()))
                        .where('W', blocks(GTOBlocks.MOLECULAR_CASING.get()))
                        .where('X', blocks(GTOBlocks.CONTAINMENT_FIELD_GENERATOR.get()))
                        .where('Y', blocks(GTOBlocks.HOLLOW_CASING.get()))
                        .where('Z', blocks(GTOBlocks.COMPRESSED_FUSION_COIL_MK2_PROTOTYPE.get()))
                        .where('[', blocks(GTOBlocks.STRENGTHEN_THE_BASE_BLOCK.get()))
                        .where('r', blocks(GTOBlocks.NAQUADAH_REINFORCED_PLANT_CASING.get()))
                        .where(']', blocks(GTOBlocks.AMPROSIUM_PIPE_CASING.get()))
                        .where('^', blocks(GTOBlocks.MAGNESIUM_OXIDE_CERAMIC_HIGH_TEMPERATURE_INSULATION_MECHANICAL_BLOCK.get()))
                        .where('_', controller(def))
                        .where(' ', any())
                        .build(),
                def -> MultiBlockFileReader.builder().name("kuangbiao5").startBuild(def)
                        .where('A', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.OdysseyNanoSuperalloy)))
                        .where('B', blocks(GTOBlocks.COMPRESSED_FUSION_COIL_MK2.get()))
                        .where('C', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTOMaterials.PlatinumManganeseAntimonyHeuslerAlloy)))
                        .where('D', blocks(GTOBlocks.VACUUM_CHAMBER_BEAM_BLOCK.get()))
                        .where('E', blocks(GTOBlocks.HIGH_PRESSURE_GAS_STORAGE_TANKS_CASING.get()))
                        .where('F', blocks(GTOBlocks.HERMETIC_CASING_UEV.get()))
                        .where('G', blocks(GTOBlocks.HIGH_PRESSURE_PIPE_CASING.get()))
                        .where('H', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Trinium)))
                        .where('I', blocks(GTOBlocks.FUSION_CASING_MK5.get()))
                        .where('J', blocks(GTOBlocks.PLASMA_FIELD_GLASS.get()))
                        .where('K', blocks(GTOBlocks.ACCELERATOR_PROTECTION_CASING.get()))
                        .where('L', blocks(GTOBlocks.RADIATION_ABSORBENT_CASING.get()))
                        .where('M', blocks(GTOBlocks.ACCELERATOR_OBSERVATION_GLASS.get()))
                        .where('N', blocks(GTOBlocks.FISSION_REACTOR_CASING.get()))
                        .where('O', blocks(GTOBlocks.NAQUADAH_ALLOY_CASING.get()))
                        .where('P', blocks(GTBlocks.FUSION_GLASS.get()))
                        .where('Q', blocks(GTOBlocks.MACHINING_CONTROL_CASING_MK3.get()))
                        .where('R', blocks(GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where('S', blocks(GTOBlocks.CONTAINMENT_FIELD_GENERATOR.get()))
                        .where('T', blocks(GTOBlocks.IMPROVED_SUPERCONDUCTOR_COIL.get()))
                        .where('U', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                        .where('V', blocks(GTOBlocks.COOLANT_PIPE_CASING.get()))
                        .where('W', blocks(GTOBlocks.OPTICAL_RESONANCE_CHAMBER.get()))
                        .where('X', blocks(GTOBlocks.MOLECULAR_COIL.get()))
                        .where('Y', blocks(GTOBlocks.FUSION_CASING_MK4.get()))
                        .where('Z', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                        .where('[', blocks(GTOBlocks.ACCELERATOR_MAGNETIC_CONSTRAINED_RAIL_CASING.get()))
                        .where('\\', blocks(GTOBlocks.RESTRAINT_DEVICE.get()))
                        .where(']', controller(def))
                        .where(' ', any())
                        .build(),
                def -> MultiBlockFileReader.builder().name("kuangbiao_crossrecipe").startBuild(def)
                        .where('A', blocks(GTBlocks.FUSION_CASING.get()))
                        .where('B', blocks(GTBlocks.FUSION_CASING.get())
                                .or(Predicates.abilities(THREAD_HATCH).setMaxGlobalLimited(1))
                                .or(Predicates.abilities(GTOPartAbility.OVERCLOCK_HATCH).setMaxGlobalLimited(1)))
                        .where('C', blocks(GCYMBlocks.CASING_NONCONDUCTING.get()))
                        .where('c', blocks(GCYMBlocks.CASING_NONCONDUCTING.get(), GTOBlocks.FUSION_CASING_MK4.get()))
                        .where('d', blocks(GCYMBlocks.CASING_NONCONDUCTING.get(), GCYMBlocks.ELECTROLYTIC_CELL.get()))
                        .where('D', blocks(GTBlocks.COMPUTER_CASING.get()))
                        .where('E', blocks(GTOBlocks.MACHINING_CONTROL_CASING_MK2.get()))
                        .where('F', blocks(GTBlocks.COMPUTER_HEAT_VENT.get()))
                        .where('G', blocks(GTBlocks.HIGH_POWER_CASING.get()))
                        .where('H', blocks(GTBlocks.CASING_PALLADIUM_SUBSTATION.get()))
                        .where('I', blocks(ChemicalHelper.getBlock(TagPrefix.frameGt, GTMaterials.Tritanium)))
                        .where('J', controller(def))
                        .where(' ', any())
                        .build());
        KUANGBIAO_ONE_GIANT_NUCLEAR_FUSION_REACTOR.setSubPatternFactory(
                KUANGBIAO_subs);
    }
}
